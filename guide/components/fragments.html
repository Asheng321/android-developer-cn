<!DOCTYPE html>












































































<html>
<head>


<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width" />

<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>活动片段 | 安卓开发者</title><!-- STYLESHEETS --><!-- JAVASCRIPT -->


<link rel="stylesheet"
href="http://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">




<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var devsite = false;
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5831155-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="gc-documentation 
  develop guide" itemscope itemtype="http://schema.org/Article"><!-- Header -->

<a name="top"></a>

    
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 logo">
          <a href="../../index.html">
            <img src="../../assets/images/dac_logo.png" width="123" height="25" alt="Android Developers" />
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
          	<a href="#" class="arrow-inactive">Quicknav</a>
			      <a href="#" class="arrow-active">Quicknav</a>
          </div>
          </div>
            <ul class="nav-x col-9">
                <li class="design">
                  <a href="../../design/index.html"
                  zh-tw-lang="設計"
                  zh-cn-lang="设计"
                  ru-lang="Проектирование"
                  ko-lang="디자인"
                  ja-lang="設計"
                  es-lang="Diseñar"               
                  >设计</a></li>
                <li class="develop"><a href="../../develop/index.html"
                  zh-tw-lang="開發"
                  zh-cn-lang="开发"
                  ru-lang="Разработка"
                  ko-lang="개발"
                  ja-lang="開発"
                  es-lang="Desarrollar"               
                  >开发</a></li>
                <li class="distribute last"><a href="../../distribute/index.html"
                  zh-tw-lang="發佈"
                  zh-cn-lang="分发"
                  ru-lang="Распространение"
                  ko-lang="배포"
                  ja-lang="配布"
                  es-lang="Distribuir"               
                  >分发</a></li>
            </ul><!-- New Search -->
            
            
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="../../about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com">Android Open Source Project</a></li>
      </ul>
      
      
      
      


      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>
  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '../../')" 
onkeyup="return search_changed(event, false, '../../')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  </div><!-- /New Search>
          
          
          <!-- Expanded quicknav -->
  
           <div id="quicknav" class="col-9">
                <ul>
                    <li class="design">
                      <ul>
                        <li><a href="../../design/index.html">入门</a></li>
                        <li><a href="../../design/style/index.html">样式</a></li>
                        <li><a href="../../design/patterns/index.html">设计模式</a></li>
                        <li><a href="../../design/building-blocks/index.html">构造块</a></li>
                        <li><a href="../../design/downloads/index.html">下载</a></li>
                        <li><a href="../../design/videos/index.html">视频</a></li>
                      </ul>
                    </li>
                    <li class="develop">
                      <ul>
                        <li><a href="../../training/index.html"
                          zh-tw-lang="訓練課程"
                          zh-cn-lang="培训"
                          ru-lang="Курсы"
                          ko-lang="교육"
                          ja-lang="トレーニング"
                          es-lang="Capacitación"               
                          >训练课程</a></li>
                        <li><a href="../../guide/components/index.html"
                          zh-tw-lang="API 指南"
                          zh-cn-lang="API 指南"
                          ru-lang="Руководства по API"
                          ko-lang="API 가이드"
                          ja-lang="API ガイド"
                          es-lang="Guías de la API"               
                          >API 指南</a></li>
                        <li><a href="../../reference/packages.html"
                          zh-tw-lang="參考資源"
                          zh-cn-lang="参考"
                          ru-lang="Справочник"
                          ko-lang="참조문서"
                          ja-lang="リファレンス"
                          es-lang="Referencia"               
                          >参考资源</a></li>
                        <li><a href="../../tools/index.html"
                          zh-tw-lang="相關工具"
                          zh-cn-lang="工具"
                          ru-lang="Инструменты"
                          ko-lang="도구"
                          ja-lang="ツール"
                          es-lang="Herramientas"               
                          >开发工具</a>
                          <ul><li><a href="../../sdk/index.html">获取 SDK</a></li></ul>
                        </li>
                        <li><a href="../../google/index.html">Google 服务</a>
                        </li>
                        
                      </ul>
                    </li>
                    <li class="distribute last">
                      <ul>
                        <li><a href="../../distribute/index.html">Google Play 市场</a></li>
                        <li><a href="../../distribute/googleplay/publish/index.html">应用发布</a></li>
                        <li><a href="../../distribute/googleplay/promote/index.html">应用推广</a></li>
                        <li><a href="../../distribute/googleplay/quality/index.html">应用质量</a></li>
                        <li><a href="../../distribute/googleplay/spotlight/index.html">精品聚焦</a></li>
                        <li><a href="../../distribute/open.html">开放发行</a></li>
                      </ul>
                    </li>
                </ul>
          </div><!-- /Expanded quicknav -->
          
        </div>
    </div><!-- /Header -->
    
    
    
  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div><!-- Secondary x-nav -->
    
    
  
    
    <div id="nav-x">
        <div class="wrap">
            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"               
                  >训练课程</a></li>
                <li class="guide"><a href="../../guide/components/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"               
                  >API 指南</a></li>
                <li class="reference"><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"               
                  >参考资源</a></li>
                <li class="tools"><a href="../../tools/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >开发工具</a></li>
                <li class="google"><a href="../../google/index.html"
                  >Google 服务</a>
                </li>
                
            </ul>
        </div>
        
    </div><!-- /Sendondary x-nav -->
    
  




  

  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="#top" data-g-event="left-nav-top">to top</a>



<ul id="nav"><!--  Walkthrough for Developers -- quick overview of what it's like to develop on Android --><!--<li style="color:red">Overview</li> -->
  
  

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/components/index.html">
        <span class="en">应用组件</span>
      </a></div>
    <ul>
      <li><a href="../../guide/components/fundamentals.html">
            <span class="en">应用基本知识</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/activities.html">
            <span class="en">活动</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/fragments.html">
              <span class="en">活动片段</span>
            </a></li>
          <li><a href="../../guide/components/loaders.html">
              <span class="en">加载器</span>
            </a></li>
          <li><a href="../../guide/components/tasks-and-back-stack.html">
              <span class="en">任务和活动堆栈</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/services.html">
            <span class="en">服务</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/bound-services.html">
              <span class="en">绑定服务</span>
            </a></li>
          <li><a href="../../guide/components/aidl.html">
              <span class="en">AIDL</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/providers/content-providers.html">
            <span class="en">内容提供商</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/providers/content-provider-basics.html">
              <span class="en">内容提供商基础</span>
            </a></li>
          <li><a href="../../guide/topics/providers/content-provider-creating.html">
              <span class="en">创建一个内容提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/calendar-provider.html">
              <span class="en">日历提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/contacts-provider.html">
              <span class="en">联系人提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/document-provider.html">
              <span class="en">存储访问框架</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/components/intents-filters.html">
          <span class="en">意图与意图过滤器</span>
        </a></li>
      <li><a href="../../guide/components/processes-and-threads.html">
          <span class="en">进程和线程</span>
        </a>
      </li>
      <li><a href="../../guide/topics/security/permissions.html">
          <span class="en">权限</span>
        </a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/appwidgets/index.html">
            <span class="en">应用小部件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/appwidgets/host.html">
              <span class="en">应用小部件托管</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/manifest/manifest-intro.html">
          <span class="en">安卓项目清单</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/manifest/action-element.html">&lt;action&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-alias-element.html">&lt;activity-alias&gt;</a></li>
          <li><a href="../../guide/topics/manifest/application-element.html">&lt;application&gt;</a></li>
          <li><a href="../../guide/topics/manifest/category-element.html">&lt;category&gt;</a></li>
          <li><a href="../../guide/topics/manifest/compatible-screens-element.html">&lt;compatible-screens&gt;</a></li>
          <li><a href="../../guide/topics/manifest/data-element.html">&lt;data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/grant-uri-permission-element.html">&lt;grant-uri-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/instrumentation-element.html">&lt;instrumentation&gt;</a></li>
          <li><a href="../../guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></li>
          <li><a href="../../guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></li>
          <li><a href="../../guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/path-permission-element.html">&lt;path-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-element.html">&lt;permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-group-element.html">&lt;permission-group&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-tree-element.html">&lt;permission-tree&gt;</a></li>
          <li><a href="../../guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></li>
          <li><a href="../../guide/topics/manifest/receiver-element.html">&lt;receiver&gt;</a></li>
          <li><a href="../../guide/topics/manifest/service-element.html">&lt;service&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-gl-texture-element.html">&lt;supports-gl-texture&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-screens-element.html">&lt;supports-screens&gt;</a></li><!-- ##api level 4## -->
          <li><a href="../../guide/topics/manifest/uses-configuration-element.html">&lt;uses-configuration&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></li><!-- ##api level 4## --> 
          <li><a href="../../guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-permission-element.html">&lt;uses-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></li>
        </ul>
   </li><!-- end of the manifest file -->

    </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/topics/ui/index.html">
        <span class="en">用户界面</span>
      </a></div>
    <ul>
      <li><a href="../../guide/topics/ui/overview.html">
          <span class="en">概述</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/declaring-layout.html">
            <span class="en">布局</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/layout/linear.html">
              <span class="en">线性布局</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/relative.html">
              <span class="en">相对布局</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/layout/grid.html">
              <span class="en">Grid Layout</span>
            </a></li>
       -->
       
          <li><a href="../../guide/topics/ui/layout/listview.html">
              <span class="en">列表视图</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/gridview.html">
              <span class="en">网格视图</span>
            </a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/controls.html">
            <span class="en">输入控件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/controls/button.html">
              <span class="en">按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/text.html">
              <span class="en">文本框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/checkbox.html">
              <span class="en">复选框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/radiobutton.html">
              <span class="en">单选按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/togglebutton.html">
              <span class="en">切换按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/spinner.html">
              <span class="en">下拉列表</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/pickers.html">
              <span class="en">选择器</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/controls/progress.html">
              <span class="en">Seek and Progress Bars</span>
            </a></li>
-->

        </ul>
      </li>
      <li><a href="../../guide/topics/ui/ui-events.html">
          <span class="en">输入事件</span>
        </a></li>
      <li><a href="../../guide/topics/ui/menus.html">
          <span class="en">菜单</span></span>
          </a></li>
      <li><a href="../../guide/topics/ui/actionbar.html">
           <span class="en">操作栏</span>
          </a></li>
      <li><a href="../../guide/topics/ui/settings.html">
            <span class="en">设置</span>
          </a></li>
      <li><a href="../../guide/topics/ui/dialogs.html">
           <span class="en">对话框</span>
          </a></li>
      <li><a href="../../guide/topics/ui/notifiers/notifications.html">
          <span class="en">通知</span>
        </a></li>
      <li><a href="../../guide/topics/ui/notifiers/toasts.html">
          <span class="en">提醒框</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/search/index.html">
            <span class="en">搜索</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/search/search-dialog.html">创建一个搜索界面</a></li>
            <li><a href="../../guide/topics/search/adding-recent-query-suggestions.html">添加最近查询建议</a></li>
            <li><a href="../../guide/topics/search/adding-custom-suggestions.html">添加自定义建议</a></li>
            <li><a href="../../guide/topics/search/searchable-config.html">可搜索配置</a></li>
          </ul>
      </li>
      <li><a href="../../guide/topics/ui/drag-drop.html">
          <span class="en">拖放</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/accessibility/index.html">
            <span class="en">辅助功能</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/accessibility/apps.html">
              <span class="en">让应用可访问</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/checklist.html">
              <span class="en">辅助功能开发者清单</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/services.html">
              <span class="en">构建辅助功能服务</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/ui/themes.html">
          <span class="en">样式与主题</span>
        </a></li>
      <li><a href="../../guide/topics/ui/custom-components.html">
          <span class="en">自定义组件</span>
        </a></li>
    </ul>
  </li><!-- end of User Interface -->

    <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/resources/index.html">
           <span class="en">应用资源</span>
         </a></div>
      <ul>
        <li><a href="../../guide/topics/resources/overview.html">
            <span class="en">概述</span>
          </a></li>
          <li><a href="../../guide/topics/resources/providing-resources.html">
            <span class="en">提供资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/accessing-resources.html">
            <span class="en">访问资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/runtime-changes.html">
              <span class="en">处理运行时更改</span>
            </a></li>
        <li><a href="../../guide/topics/resources/localization.html">
            <span class="en">本地化</span>
          </a></li>
        <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/resources/available-resources.html">
              <span class="en">资源类型</span>
            </a></div>
          <ul>
            <li><a href="../../guide/topics/resources/animation-resource.html">动画</a></li>
            <li><a href="../../guide/topics/resources/color-list-resource.html">颜色状态列表</a></li>
            <li><a href="../../guide/topics/resources/drawable-resource.html">可描绘资源</a></li>
            <li><a href="../../guide/topics/resources/layout-resource.html">布局</a></li>
            <li><a href="../../guide/topics/resources/menu-resource.html">菜单</a></li>
            <li><a href="../../guide/topics/resources/string-resource.html">字符串</a></li>
            <li><a href="../../guide/topics/resources/style-resource.html">样式</a></li>
            <li><a href="../../guide/topics/resources/more-resources.html">更多类型</a></li>
          </ul>
        </li><!-- end of resource types -->
      </ul>
    </li><!-- end of app resources -->

   <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/graphics/index.html">
          <span class="en">动画与图形</span>
        </a></div>
      <ul>
      <li class="nav-section">
        </li><li><a href="../../guide/topics/graphics/overview.html">
            <span class="en">概述</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/prop-animation.html">
            <span class="en">属性动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/view-animation.html">
            <span class="en">补间动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/drawable-animation.html">
            <span class="en">帧动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/2d-graphics.html">
            <span class="en">画布与图形</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/opengl.html">
            <span class="en">OpenGL ES</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/hardware-accel.html">
            <span class="en">硬件加速</span>
          </a></li>
       </ul>
    </li><!-- end of graphics and animation-->

   <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/topics/renderscript/index.html">
              <span class="en">计算</span>
            </a></div>
            <ul>
              <li><a href="../../guide/topics/renderscript/compute.html">
                    <span class="en">RenderScript</span></a>
                  </li>

              <li><a href="../../guide/topics/renderscript/advanced.html">
                    <span class="en">RenderScript 进阶</span></a>
                  </li>
              <li><a href="../../guide/topics/renderscript/reference.html">
                    <span class="en">运行时 API 参考</span></a>
              </li>
             </ul>
   </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/media/index.html">
            <span class="en">多媒体与照相机</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/media/mediaplayer.html">
                  <span class="en">多媒体播放</span></a>
                </li>
            <li><a href="../../guide/appendix/media-formats.html">
                   <span class="en">支持的多媒体格式</span></a>
                </li>
            <li><a href="../../guide/topics/media/audio-capture.html">
                  <span class="en">音频录制</span></a>
                </li>
            <li><a href="../../guide/topics/media/jetplayer.html">
                  <span class="en">JetPlayer</span></a>
                </li>
            <li><a href="../../guide/topics/media/camera.html">
                  <span class="en">照相机</span></a>
                </li>
          </ul>
      </li><!-- end of media and camera -->

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/sensors/index.html">
              <span class="en">位置与传感器</span>
              </a></div>
        <ul>
          <li><a href="../../guide/topics/location/index.html">
               <span class="en">位置和地图</span>
             </a>
          </li><li><a href="../../guide/topics/location/strategies.html">
               <span class="en">位置策略</span>
             </a></li>
          <li><a href="../../guide/topics/sensors/sensors_overview.html">
              <span class="en">传感器概述</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_motion.html">
              <span class="en">动作传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_position.html">
              <span class="en">位置传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_environment.html">
              <span class="en">环境传感器</span>
            </a></li>
        </ul>
      </li><!-- end of location and sensors -->



<li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/index.html">
               <span class="en">连接性</span>
             </a></div>
        <ul>
          <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/bluetooth.html">
          <span class="en">蓝牙</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/bluetooth-le.html">低功耗蓝牙</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/nfc/index.html">
          <span class="en">NFC</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/nfc/nfc.html">NFC 基础</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/advanced-nfc.html">高级 NFC</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/hce.html">Host-based Card Emulation</a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/connectivity/wifip2p.html">
            <span class="en">Wi-Fi P2P</span></a>
          </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/connectivity/usb/index.html">
            <span class="en">USB</span></a>
          </div>
            <ul>
              <li><a href="../../guide/topics/connectivity/usb/accessory.html">附件</a></li>
              <li><a href="../../guide/topics/connectivity/usb/host.html">主机</a></li>
            </ul>
     </li>
     <li><a href="../../guide/topics/connectivity/sip.html">
            <span class="en">SIP</span>
          </a>
     </li>

    </ul>
  </li><!-- end of connectivity -->


      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/text/index.html">
            <span class="en">文本与输入</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/text/copy-paste.html">
              <span class="en">复制和粘贴</span>
            </a></li>
          <li><a href="../../guide/topics/text/creating-input-method.html">
              <span class="en">创建输入法引擎</span>
            </a></li>
          <li><a href="../../guide/topics/text/spell-checker-framework.html">
              <span class="en">拼写检查</span>
            </a></li>
        </ul>
      </li><!-- end of text and input -->

     <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/data/index.html">
          <span class="en">数据存储</span>
        </a></div>
      <ul>
         <li><a href="../../guide/topics/data/data-storage.html">
            <span class="en">存储选项</span>
           </a></li>
        <li><a href="../../guide/topics/data/backup.html">
            <span class="en">数据备份</span>
          </a></li>
        <li><a href="../../guide/topics/data/install-location.html">
            <span class="en">应用安装位置</span>
          </a></li>
      </ul>
    </li><!-- end of data storage -->


  <li class="nav-section">
           <div class="nav-section-header"><a href="../../guide/topics/admin/index.html">
               <span class="en">管理</span>
             </a></div>
           <ul>
              <li>
                <a href="../../guide/topics/admin/device-admin.html">
                <span class="en">设备管理</span></a>
              </li><!--
              <li>
                <a href="../../guide/topics/admin/keychain.html">
                <span class="en">Certificate Store</span></a>
              </li>
            -->
            
           </ul>
  </li><!-- end of administration -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/webapps/index.html">
    <span class="en">Web 应用</span>
    </a></div>
    <ul>
      <li><a href="../../guide/webapps/overview.html">
            <span class="en">概述</span>
          </a></li>
      <li><a href="../../guide/webapps/targeting.html">
            <span class="en">Web 应用的目标屏幕</span>
          </a></li>
      <li><a href="../../guide/webapps/webview.html">
            <span class="en">在 WebView 中创建 Web 应用</span>
          </a></li>
      <li><a href="../../guide/webapps/migrating.html">
            <span class="en">迁移到 Android 4.4 版本的 WebView</span>
          </a></li>
      <li><a href="../../guide/webapps/debugging.html">
            <span class="en">Web 应用调试</span>
          </a></li>
      <li><a href="../../guide/webapps/best-practices.html">
            <span class="en">Web 应用的最佳实践</span>
          </a></li>
    </ul>
  </li><!-- end of web apps -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/practices/index.html">
      <span class="en">最佳实践</span> <span class="de" style="display:none">Bewährte Verfahren</span> <span class="es" style="display:none">Prácticas recomendadas</span> <span class="fr" style="display:none">Meilleures pratiques</span> <span class="it" style="display:none">Best practice</span> <span class="ja" style="display:none">ベスト プラクティス</span> <span class="zh-cn" style="display:none">最佳实践</span> <span class="zh-tw" style="display:none">最佳實務</span>
    </a></div></a>
    <ul>
      <li><a href="../../guide/practices/compatibility.html">
            <span class="en">兼容性</span>
          </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/screens_support.html">
          <span class="en">支持多个屏幕</span>
        </a></div>
        <ul>
          <li><a href="../../guide/practices/screens-distribution.html">
            <span class="en">分发给特定的屏幕</span>
          </a></li>
          <li><a href="../../guide/practices/screen-compat-mode.html">
            <span class="en">屏幕兼容性模式</span>
          </a></li>
        </ul>
      </li>
      <li><a href="../../guide/practices/tablets-and-handsets.html">
            <span class="en">支持平板设备和手持设备</span>
          </a></li>

    </ul>
  </li><!-- this needs to move
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/index.html">
               <span class="en">UI Guidelines</span>
             </a></div>
        <ul>
          <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/icon_design.html">
                   <span class="en">Icon Design</span>
                 </a></div>
            <ul>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_launcher.html">
                    <span class="en">Launcher Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_menu.html">
                    <span class="en">Menu Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_action_bar.html">
                    <span class="en">Action Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_status_bar.html">
                    <span class="en">Status Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_tab.html">
                    <span class="en">Tab Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_dialog.html">
                    <span class="en">Dialog Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_list.html">
                    <span class="en">List View Icons</span>
                  </a></li>
            </ul>
          </li>
          <li><div><a href="../../guide/practices/ui_guidelines/widget_design.html">
                <span class="en">App Widget Design</span>
              </a></div>
          </li>
        </ul>
      </li>
        </ul> --><!-- Remove
  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/appendix/index.html">
        <span class="en">Appendix</span>
        <span class="de" style="display:none">Anhang</span>
        <span class="es" style="display:none">Apéndice</span>
        <span class="fr" style="display:none">Annexes</span>
        <span class="it" style="display:none">Appendice</span>
        <span class="ja" style="display:none">付録</span>
        <span class="zh-cn" style="display:none">附录</span>
        <span class="zh-tw" style="display:none">附錄</span>
      </a></div>
    <ul>
      <li><a href="../../guide/appendix/g-app-intents.html">
            <span class="en">Intents List: Google Apps</span>
          </a></li>


      <li><a href="../../guide/appendix/glossary.html">
            <span class="en">Glossary</span>
          </a></li>
    </ul>
  </li>

</li>
-->

      


</ul>


<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>


        

      </div>
    </div><!-- end side-nav --> 
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >活动片段</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
<div id="qv">

  <h2>要点</h2>
  <ul>
    <li>Fragments decompose application functionality and UI into reusable modules</li>
    <li>Add multiple fragments to a screen to avoid switching activities</li>
    <li>Fragments have their own lifecycle, state, and back stack</li>
    <li>Fragments require API Level 11 or greater</li>
  </ul>

  <h2>在本文档中</h2>
  <ol>
    <li><a href="#Design">Design Philosophy</a></li>
    <li><a href="#Creating">创建活动片段</a>
      <ol>
        <li><a href="#UI">添加用户界面</a></li>
        <li><a href="#Adding">添加活动片段到活动组件</a></li>
      </ol>
    </li>
    <li><a href="#Managing">Managing Fragments</a></li>
    <li><a href="#Transactions">Performing Fragment Transactions</a></li>
    <li><a href="#CommunicatingWithActivity">与活动组件通信</a>
      <ol>
        <li><a href="#EventCallbacks">给活动组件创建事件回调</a></li>
        <li><a href="#ActionBar">Adding items to the Action Bar</a></li>
      </ol>
    </li>
    <li><a href="#Lifecycle">Handling the Fragment Lifecycle</a>
      <ol>
        <li><a href="#CoordinatingWithActivity">Coordinating with the activity lifecycle</a></li>
      </ol>
    </li>
    <li><a href="#Example">例子</a></li>
  </ol>

  <h2>Key classes</h2>
  <ol>
    <li><code><a href="../../reference/android/app/Fragment.html">Fragment</a></code></li>
    <li><code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code></li>
    <li><code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code></li>
  </ol>
  
  <h2>参考</h2>
  <ol>
    <li><a href="../../training/basics/fragments/index.html">使用活动片段创建动态界面</a></li>
    <li><a href="../../guide/practices/tablets-and-handsets.html">支持平板设备和手持设备</a></li>
  </ol>
</div>
</div>

<p>A <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> represents a behavior or a portion of user interface in an
<code><a href="../../reference/android/app/Activity.html">Activity</a></code>. You can combine multiple fragments in a single activity to build a
multi-pane UI and reuse a fragment in multiple activities. You can think of a fragment as a
modular section of an activity, which has its own lifecycle, receives its own input events, and
which you can add or remove while the activity is running (sort of like a "sub activity" that
you can reuse in different activities).</p>

<p>A fragment must always be embedded in an activity and the fragment's lifecycle is directly
affected by the host activity's lifecycle. For example, when the activity is paused, so are all
fragments in it, and when the activity is destroyed, so are all fragments. However, while an
activity is running (it is in the <em>resumed</em> <a
href="../../guide/components/activities.html#Lifecycle">lifecycle state</a>), you can
manipulate each fragment independently, such as add or remove them. When you perform such a
fragment transaction, you can also add it to a back stack that's managed by the
activity—each back stack entry in the activity is a record of the fragment transaction that
occurred. The back stack allows the user to reverse a fragment transaction (navigate backwards),
by pressing the <em>Back</em> button.</p>

<p>When you add a fragment as a part of your activity layout, it lives in a <code><a href="../../reference/android/view/ViewGroup.html">ViewGroup</a></code> inside the activity's view hierarchy and the fragment defines its own view
layout.
You can insert a fragment into your activity layout by declaring the fragment in the activity's
layout file, as a <code>&lt;fragment&gt;</code> element, or from your application code by adding it to an
existing <code><a href="../../reference/android/view/ViewGroup.html">ViewGroup</a></code>. However, a fragment is not required to be a part of the
activity layout; you may also use a fragment without its own UI as an invisible worker for the
activity.</p>

<p>This document describes how to build your application to use fragments, including
how fragments can maintain their state when added to the activity's back stack, share
events with the activity and other fragments in the activity, contribute to the activity's action
bar, and more.</p>


<h2 id="Design">Design Philosophy</h2>

<p>Android introduced fragments in Android 3.0 (API level 11), primarily to support more
dynamic and flexible UI designs on large screens, such as tablets. Because a
tablet's screen is much larger than that of a handset, there's more room to combine and
interchange UI components. Fragments allow such designs without the need for you to manage complex
changes to the view hierarchy. By dividing the layout of an activity into fragments, you become able
to modify the activity's appearance at runtime and preserve those changes in a back stack
that's managed by the activity.</p>

<p>For example, a news application can use one fragment to show a list of articles on the
left and another fragment to display an article on the right—both fragments appear in one
activity, side by side, and each fragment has its own set of lifecycle callback methods and handle
their own user input events. Thus, instead of using one activity to select an article and another
activity to read the article, the user can select an article and read it all within the same
activity, as illustrated in the tablet layout in figure 1.</p>

<p>You should design each fragment as a modular and reusable activity component. That is, because
each fragment defines its own layout and its own behavior with its own lifecycle callbacks, you can
include one fragment in multiple activities, so you should design for reuse and avoid directly
manipulating one fragment from another fragment. This is especially important because a modular
fragment allows you to change your fragment combinations for different screen sizes. When designing
your application to support both tablets and handsets, you can reuse your fragments in different
layout configurations to optimize the user experience based on the available screen space. For
example, on a handset, it might be necessary to separate fragments to provide a single-pane UI when
more than one cannot fit within the same activity.</p>

<img src="../../images/fundamentals/fragments.png" alt="" />
<p class="img-caption"><strong>Figure 1.</strong> An example of how two UI modules defined by
fragments can be combined into one activity for a tablet design, but separated for a
handset design.</p>

<p>For example—to continue with the news application example—the application can embed
two fragments in <em>Activity A</em>, when running on a tablet-sized device. However, on a
handset-sized screen, there's not enough room for both fragments, so <em>Activity A</em> includes
only the fragment for the list of articles, and when the user selects an article, it starts
<em>Activity B</em>, which includes the second fragment to read the article. Thus, the application
supports both tablets and handsets by reusing fragments in different combinations, as illustrated in
figure 1.</p>

<p>For more information about designing your application with different fragment combinations for
different screen configurations, see the guide to <a
href="../../guide/practices/tablets-and-handsets.html">Supporting Tablets and Handsets</a>.</p>



<h2 id="Creating">创建活动片段</h2>

<div class="figure" style="width:327px">
<img src="../../images/fragment_lifecycle.png" alt="" />
<p class="img-caption"><strong>Figure 2.</strong> The lifecycle of a fragment (while its
activity is running).</p>
</div>

<p>To create a fragment, you must create a subclass of <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> (or an existing
subclass of it). The <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> class has code that looks a lot like
an <code><a href="../../reference/android/app/Activity.html">Activity</a></code>. It contains callback methods similar to an activity, such
as <code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code>, <code><a href="../../reference/android/app/Fragment.html#onStart()">onStart()</a></code>,
<code><a href="../../reference/android/app/Fragment.html#onPause()">onPause()</a></code>, and <code><a href="../../reference/android/app/Fragment.html#onStop()">onStop()</a></code>. In
fact, if you're converting an existing Android application to use fragments, you might simply move
code from your activity's callback methods into the respective callback methods of your
fragment.</p>

<p>Usually, you should implement at least the following lifecycle methods:</p>

<dl>
  <dt><code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code></dt>
  <dd>The system calls this when creating the fragment. Within your implementation, you should
initialize essential components of the fragment that you want to retain when the fragment is
paused or stopped, then resumed.</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code></dt>
  <dd>The system calls this when it's time for the fragment to draw its user interface for the
first time. To draw a UI for your fragment, you must return a <code><a href="../../reference/android/view/View.html">View</a></code> from this
method that is the root of your fragment's layout. You can return null if the fragment does not
provide a UI.</dd>
  <dt><code><a href="../../reference/android/app/Activity.html#onPause()">onPause()</a></code></dt>
  <dd>The system calls this method as the first indication that the user is leaving the fragment (though it does not always mean the fragment is being destroyed). 因为用户可能不会返回该活动，在这个回调中你应该提交所有应持久化的改变，让这些改变能在下次用户回话中仍生效。</dd>
</dl>

<p>Most applications should implement at least these three methods for every fragment, but there are
several other callback methods you should also use to handle various stages of the
fragment lifecycle. All the lifecycle callback methods are discussed in more detail in the section
about <a href="#Lifecycle">Handling the Fragment Lifecycle</a>.</p>


<p>There are also a few subclasses that you might want to extend, instead of the base <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> class:</p>

<dl>
  <dt><code><a href="../../reference/android/app/DialogFragment.html">DialogFragment</a></code></dt>
  <dd>Displays a floating dialog. Using this class to create a dialog is a good alternative to using
the dialog helper methods in the <code><a href="../../reference/android/app/Activity.html">Activity</a></code> class, because you can
incorporate a fragment dialog into the back stack of fragments managed by the activity,
allowing the user to return to a dismissed fragment.</dd>

  <dt><code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code></dt>
  <dd>Displays a list of items that are managed by an adapter (such as a <code><a href="../../reference/android/widget/SimpleCursorAdapter.html">SimpleCursorAdapter</a></code>), similar to <code><a href="../../reference/android/app/ListActivity.html">ListActivity</a></code>. It provides
several methods for managing a list view, such as the <code><a href="../../reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">onListItemClick()</a></code> callback to
handle click events.</dd>

  <dt><code><a href="../../reference/android/preference/PreferenceFragment.html">PreferenceFragment</a></code></dt>
  <dd>Displays a hierarchy of <code><a href="../../reference/android/preference/Preference.html">Preference</a></code> objects as a list, similar to
<code><a href="../../reference/android/preference/PreferenceActivity.html">PreferenceActivity</a></code>. This is useful when creating a "settings"
activity for your application.</dd>
</dl>


<h3 id="UI">添加用户界面</h3>

<p>活动片段通常用作活动用户界面的一部分，它为活动组件贡献自己部分的布局。</p>

<p>要给活动片段提供一个布局，你必须实现 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 回调方法，当活动片段绘制它的布局时安卓系统会调用这个方法。这个方法的实现必须返回一个 <code><a href="../../reference/android/view/View.html">View</a></code> 对象，它是你的活动片段布局的根视图。</p>

<p class="note"><strong>注意：</strong> 如果活动片段是 <code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code> 的子类，默认实现从 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法返回一个 <code><a href="../../reference/android/widget/ListView.html">ListView</a></code> 类 , 这样你不需要实现它。</p>

<p>要从 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code>方法返回一个布局，你可以从用 XML 语言定义的<a
href="../../guide/topics/resources/layout-resource.html">布局资源</a>来填充它。为了帮助你，<code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法提供了一个 <code><a href="../../reference/android/view/LayoutInflater.html">LayoutInflater</a></code> 对象。</p>

<p>例如，这里是一个 <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 子类，它从 <code>example_fragment.xml</code> 文件中加载一个布局：</p>

<pre>
public static class ExampleFragment extends Fragment {
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.example_fragment, container, false);
    }
}
</pre>

<div class="sidebox-wrapper">
<div class="sidebox">
  <h3>创建布局</h3>
  <p>在上面的例子中，<code>R.layout.example_fragment</code> 是对保存在应用资源的 <code>example_fragment.xml</code> 文件的引用。更多如何使用 XML 语言创建布局的信息，查看<a href="../../guide/topics/ui/index.html">用户界面</a>文档。</p>
</div>
</div>

<p>传递给 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法的 <code>container</code>  参数是是父<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>（来自活动布局），你的活动片段布局将插入到这里。<code>savedInstanceState</code> 参数是一个 <code><a href="../../reference/android/os/Bundle.html">Bundle</a></code>，当活动片段恢复时它提供之前活动片段实例数据（关于恢复状态会在<a href="#Lifecycle">处理活动片段生命周期</a>小节中有更多讨论）。</p>

<p><code><a href="../../reference/android/view/LayoutInflater.html#inflate(int, android.view.ViewGroup, boolean)">inflate()</a></code> 方法带有三个参数：</p>
<ul>
  <li>你希望填充的资源 ID。</li>
  <li>被填充布局的父<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>。传入的 <code>container</code> 参数对系统将布局应用到被填充布局的主视图上非常重要，这个参数由父视图指定。</li>
  <li>一个布尔值表示被填充的布局当填充时是否应该附加到<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>上（第二个参数）。(在这个例子中，这个参数设置为 false 因为系统已经将被填充的视图插入到 <code>container</code> 中，而传 true 值会在最终布局中创建一个多余的视图组。）</li>
</ul>

<p>现在你已经看到如何创建一个提供布局的活动片段。下一步，你需要添加活动片段到你的活动组件中。</p>



<h3 id="Adding">添加活动片段到活动组件</h3>

<p>通常，活动片段向活动宿主提供一部分用户界面，它作为活动组件的整体视图结构的一部分嵌入。有两种方法添加一个活动片段到活动布局中：</p>

<ul>
  <li><b>在活动布局文件中声明活动片段。</b>
<p>在这种情况中，你可以用类似声明视图的方法指定布局属性为活动片段。例如，下面是一个带两个活动片段的活动组件的布局文件：</p>
<pre>
<?xml version="1.0" encoding="UTF-8"?>
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;fragment android:name="com.example.news.ArticleListFragment"
            android:id="@+id/list"
            android:layout_weight="1"
            android:layout_width="0dp"
            android:layout_height="match_parent" /&gt;
    &lt;fragment android:name="com.example.news.ArticleReaderFragment"
            android:id="@+id/viewer"
            android:layout_weight="2"
            android:layout_width="0dp"
            android:layout_height="match_parent" /&gt;
&lt;/LinearLayout&gt;
</pre>
  <p><code>&lt;fragment&gt;</code> 节点的 <code>android:name</code> 指定 <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 类来实例化布局。</p>

<p>当系统创建这个活动布局，它实例化每一个布局中指定的活动片段并调用各自的 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法来获得每个活动偏度的布局。系统将活动片段返回的<code><a href="../../reference/android/view/View.html">视图</a></code>直接插入到 <code>&lt;fragment&gt;</code> 元素的位置。</p>

<div class="note">
  <p><strong>Note:</strong> Each fragment requires a unique identifier that
the system can use to restore the fragment if the activity is restarted (and which you can use to
capture the fragment to perform transactions, such as remove it). There are three ways to provide an
ID for a fragment:</p>
  <ul>
    <li>Supply the <code>android:id</code> attribute with a unique ID.</li>
    <li>Supply the <code>android:tag</code> attribute with a unique string.</li>
    <li>If you provide neither of the previous two, the system uses the ID of the container 
view.</li>
  </ul>
</div>
  </li>

  <li><b>Or, programmatically add the fragment to an existing <code><a href="../../reference/android/view/ViewGroup.html">ViewGroup</a></code>.</b>
<p>At any time while your activity is running, you can add fragments to your activity layout. You
simply need to specify a <code><a href="../../reference/android/view/ViewGroup.html">ViewGroup</a></code> in which to place the fragment.</p>
  <p>To make fragment transactions in your activity (such as add, remove, or replace a
fragment), you must use APIs from <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code>. You can get an instance
of <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code> from your <code><a href="../../reference/android/app/Activity.html">Activity</a></code> like this:</p>

<pre>
FragmentManager fragmentManager = <code><a href="../../reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code>
FragmentTransaction fragmentTransaction = fragmentManager.<code><a href="../../reference/android/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code>;
</pre>

<p>You can then add a fragment using the <code><a href="../../reference/android/app/FragmentTransaction.html#add(int, android.app.Fragment)">add()</a></code> method, specifying the fragment to add and the view in which to insert it. 例如：</p>

<pre>
ExampleFragment fragment = new ExampleFragment();
fragmentTransaction.add(R.id.fragment_container, fragment);
fragmentTransaction.commit();
</pre>

  <p>The first argument passed to <code><a href="../../reference/android/app/FragmentTransaction.html#add(int, android.app.Fragment)">add()</a></code>
is the <code><a href="../../reference/android/view/ViewGroup.html">ViewGroup</a></code> in which the fragment should be placed, specified by
resource ID, and the second parameter is the fragment to add.</p>
  <p>Once you've made your changes with
<code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code>, you must
call <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> for the changes to take effect.</p>
  </li>
</ul>


<h4 id="AddingWithoutUI">Adding a fragment without a UI</h4>

<p>The examples above show how to add a fragment to your activity in order to provide a UI. However,
you can also use a fragment to provide a background behavior for the activity without presenting
additional UI.</p>

<p>To add a fragment without a UI, add the fragment from the activity using <code><a href="../../reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">add(Fragment, String)</a></code> (supplying a unique string "tag" for the
fragment, rather than a view ID). This adds the fragment, but, because it's not associated with a
view in the activity layout, it does not receive a call to <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code>. So you don't need to implement that method.</p>

<p>Supplying a string tag for the fragment isn't strictly for non-UI fragments—you can also
supply string tags to fragments that do have a UI—but if the fragment does not have a
UI, then the string tag is the only way to identify it. If you want to get the fragment from the
activity later, you need to use <code><a href="../../reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">findFragmentByTag()</a></code>.</p>

<p>For an example activity that uses a fragment as a background worker, without a UI, see the <a
href="../../resources/samples/ApiDemos/src/com/example/android/apis/app/FragmentRetainInstance.html"><code>FragmentRetainInstance.java</code></a> sample.</p>



<h2 id="Managing">Managing Fragments</h2>

<p>To manage the fragments in your activity, you need to use <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code>. To
get it, call <code><a href="../../reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code> from your activity.</p>

<p>Some things that you can do with <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> include:</p>

<ul>
  <li>Get fragments that exist in the activity, with <code><a href="../../reference/android/app/FragmentManager.html#findFragmentById(int)">findFragmentById()</a></code> (for fragments that provide a UI in
the activity layout) or <code><a href="../../reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">findFragmentByTag()</a></code> (for fragments that do or don't provide a UI).</li> 
  <li>Pop fragments off the back stack, with <code><a href="../../reference/android/app/FragmentManager.html#popBackStack()">popBackStack()</a></code> (simulating a <em>Back</em> command by the user).</li>
  <li>Register a listener for changes to the back stack, with <code><a href="../../reference/android/app/FragmentManager.html#addOnBackStackChangedListener(android.app.FragmentManager.OnBackStackChangedListener)">addOnBackStackChangedListener()</a></code>.</li>
</ul>

<p>For more information about these methods and others, refer to the <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> class documentation.</p>

<p>As demonstrated in the previous section, you can also use <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code>
to open a <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code>, which allows you to perform transactions, such as
add and remove fragments.</p>


<h2 id="Transactions">Performing Fragment Transactions</h2>

<p>A great feature about using fragments in your activity is the ability to add, remove, replace,
and perform other actions with them, in response to user interaction. Each set of changes that you
commit to the activity is called a transaction and you can perform one using APIs in <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code>. You can also save each transaction to a back stack managed by the
activity, allowing the user to navigate backward through the fragment changes (similar to navigating
backward through activities).</p>

<p>You can acquire an instance of <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code> from the <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> like this:</p>

<pre>
FragmentManager fragmentManager = <code><a href="../../reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code>;
FragmentTransaction fragmentTransaction = fragmentManager.<code><a href="../../reference/android/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code>;
</pre>

<p>Each transaction is a set of changes that you want to perform at the same time. You can set
up all the changes you want to perform for a given transaction using methods such as <code><a href="../../reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">add()</a></code>, <code><a href="../../reference/android/app/FragmentTransaction.html#remove(android.app.Fragment)">remove()</a></code>,
and <code><a href="../../reference/android/app/FragmentTransaction.html#replace(int, android.app.Fragment)">replace()</a></code>. Then, to apply the transaction
to the activity, you must call <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code>.</p>
</dl>

<p>Before you call <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code>, however, you might want to call <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code>, in order to add the transaction
to a back stack of fragment transactions. This back stack is managed by the activity and allows
the user to return to the previous fragment state, by pressing the <em>Back</em> button.</p>

<p>For example, here's how you can replace one fragment with another, and preserve the previous
state in the back stack:</p>

<pre>
// Create new fragment and transaction
Fragment newFragment = new ExampleFragment();
FragmentTransaction transaction = getFragmentManager().beginTransaction();

// Replace whatever is in the fragment_container view with this fragment,
// and add the transaction to the back stack
transaction.replace(R.id.fragment_container, newFragment);
transaction.addToBackStack(null);

// Commit the transaction
transaction.commit();
</pre>

<p>In this example, <code>newFragment</code> replaces whatever fragment (if any) is currently in the
layout container identified by the <code>R.id.fragment_container</code> ID. By calling <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code>, the replace transaction is
saved to the back stack so the user can reverse the transaction and bring back the
previous fragment by pressing the <em>Back</em> button.</p>

<p>If you add multiple changes to the transaction (such as another <code><a href="../../reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">add()</a></code> or <code><a href="../../reference/android/app/FragmentTransaction.html#remove(android.app.Fragment)">remove()</a></code>) and call <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code>, then all changes applied
before you call <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> are added to the
back stack as a single transaction and the <em>Back</em> button will reverse them all together.</p>

<p>The order in which you add changes to a <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code> doesn't matter,
except:</p>
<ul>
  <li>You must call <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> last</li>
  <li>If you're adding multiple fragments to the same container, then the order in which
you add them determines the order they appear in the view hierarchy</li>
</ul>

<p>If you do not call <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> when you perform a transaction that removes a fragment, then that fragment is
destroyed when the transaction is committed and the user cannot navigate back to it. Whereas, if you
do call <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> when
removing a fragment, then the fragment is <em>stopped</em> and will be resumed if the user navigates
back.</p>

<p class="note"><strong>Tip:</strong> For each fragment transaction, you can apply a transition
animation, by calling <code><a href="../../reference/android/app/FragmentTransaction.html#setTransition(int)">setTransition()</a></code> before
you commit.</p>

<p>Calling <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> does not perform the transaction
immediately. Rather, it schedules it to run on the activity's UI thread (the "main" thread) as soon
as the thread is able to do so. If necessary, however, you may call <code><a href="../../reference/android/app/FragmentManager.html#executePendingTransactions()">executePendingTransactions()</a></code> from your UI thread to immediately execute
transactions submitted by <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code>. Doing so is
usually not necessary unless the transaction is a dependency for jobs in other threads.</p>

<p class="caution"><strong>警告：</strong>你只能在活动组件<a
href="../../guide/components/activities.html#SavingActivityState">保持它的状态</a>（当用户离开活动）前使用  <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法提交事务。如果你在那个点后尝试提交事务，会抛出一个例外。这是因为如果活动组件需要被还原时，事务提交后的状态会丢失。对于可以丢失的事务提交，使用 <code><a href="../../reference/android/app/FragmentTransaction.html#commitAllowingStateLoss()">commitAllowingStateLoss()</a></code> 方法。</p>




<h2 id="CommunicatingWithActivity">与活动组件通信</h2>

<p>尽管<code><a href="../../reference/android/app/Fragment.html">活动碎片</a></code>实现成一个独立于<code><a href="../../reference/android/app/Activity.html">活动</a></code>的对象而且可以在多个活动中使用，一个给定的活动碎片实例被直接绑到包含它的活动组件上。</p>

<p>特别地，活动碎片可以使用 <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> 方法访问<code><a href="../../reference/android/app/Activity.html">活动</a></code>实例，并且能执行像在活动布局中查找视图这种任务：</p>

<pre>
View listView = <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code>.<code><a href="../../reference/android/app/Activity.html#findViewById(int)">findViewById</a></code>(R.id.list);
</pre>

<p>相似地，你的活动组件可以通过 <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> 类的 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentById(int)">findFragmentById()</a></code> 或 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">findFragmentByTag()</a></code> 方法获取<code><a href="../../reference/android/app/Fragment.html">活动碎片</a></code>的引用来调用活动碎片中的方法。例如：</p>

<pre>
ExampleFragment fragment = (ExampleFragment) getFragmentManager().findFragmentById(R.id.example_fragment);
</pre>


<h3 id="EventCallbacks">给活动组件创建事件回调</h3>

<p>在一些情况中，你可能需要一个活动碎片同活动组件共享事件。一个不错的方法是在活动碎片中定义回调接口然后在活动宿主中实现它。当活动通过接口收到回调事件，必要时它可以同其它活动碎片共享信息。</p>

<p>例如，如果一个新闻英语在一个活动内有两个活动碎片 — 其中一个显示文章列表（活动碎片 A）另一个显示单个文章（活动碎片 B）— 那么当列表项被选择时活动碎片 A 必须告诉活动组件，这样活动组件可以告诉活动碎片 B 来显示这个文章。在这个例子中，<code>OnArticleSelectedListener</code> 接口在活动碎片 A 中声明：</p>

<pre>
public static class FragmentA extends ListFragment {
    ...
    // Container Activity must implement this interface
    public interface OnArticleSelectedListener {
        public void onArticleSelected(Uri articleUri);
    }
    ...
}
</pre>

<p>然后包含活动碎片的活动组件实现 <code>OnArticleSelectedListener</code> 接口并重载 <code>onArticleSelected()</code> 方法来通知活动碎片 B 来自活动碎片 A 的事件。要确保宿主活动实现这个接口，活动碎片 A 的 <code><a href="../../reference/android/app/Fragment.html#onAttach(android.app.Activity)">onAttach()</a></code> 回调方法（当活动碎片添加到活动组件时系统调用这个方法）将 <code><a href="../../reference/android/app/Fragment.html#onAttach(android.app.Activity)">onAttach()</a></code> 参数传入的<code><a href="../../reference/android/app/Activity.html">活动组件</a></code>转换成 <code>OnArticleSelectedListener</code> 实例：</p>

<pre>
public static class FragmentA extends ListFragment {
    OnArticleSelectedListener mListener;
    ...
    @Override
    public void onAttach(Activity activity) {
        super.onAttach(activity);
        try {
            mListener = (OnArticleSelectedListener) activity;
        } catch (ClassCastException e) {
            throw new ClassCastException(activity.toString() + " must implement OnArticleSelectedListener");
        }
    }
    ...
}
</pre>

<p>如果活动组件没有实现接口，那么活动碎片会抛出一个 <code><a href="../../reference/java/lang/ClassCastException.html">ClassCastException</a></code> 例外。如果成功， <code>mListener</code> 字段会保持一个实现了 <code>OnArticleSelectedListener</code> 接口的活动引用，这样活动碎片 A 可以通过调用 <code>OnArticleSelectedListener</code> 接口中定义的方法同活动组件共享事件。例如，如果活动碎片 A 是 <code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code> 的扩展，每次用户单击列表项，系统调用活动碎片的 <code><a href="../../reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">onListItemClick()</a></code> 方法，该方法再调用 <code>onArticleSelected()</code> 来和活动组件共享这个事件。</p>

<pre>
public static class FragmentA extends ListFragment {
    OnArticleSelectedListener mListener;
    ...
    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        // Append the clicked item's row ID with the content provider Uri
        Uri noteUri = ContentUris.<code><a href="../../reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">withAppendedId</a></code>(ArticleColumns.CONTENT_URI, id);
        // Send the event and Uri to the host activity
        mListener.onArticleSelected(noteUri);
    }
    ...
}
</pre>

<p>传给 <code><a href="../../reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">onListItemClick()</a></code> 方法的 <code>id</code> 参数是被点击项目的行 ID，活动组件（或者其他活动碎片）使用这个 ID 从应用的<code><a href="../../reference/android/content/ContentProvider.html">内容提供器</a></code>中提取文章。</p>

<p><!--To see a complete implementation of this kind of callback interface, see the <a
href="../../resources/samples/NotePad/index.html">NotePad sample</a>. -->更多关于使用内容提供器的信息，查看<a
href="../../guide/topics/providers/content-providers.html">内容提供器</a>文档。</p>



<h3 id="ActionBar">Adding items to the Action Bar</h3>

<p>Your fragments can contribute menu items to the activity's <a
href="../../guide/topics/ui/menus.html#options-menu">Options Menu</a> (and, consequently, the <a
href="../../guide/topics/ui/actionbar.html">Action Bar</a>) by implementing
<code><a href="../../reference/android/app/Fragment.html#onCreateOptionsMenu(android.view.Menu, android.view.MenuInflater)">onCreateOptionsMenu()</a></code>. In order
for this method to receive calls, however, you must call <code><a href="../../reference/android/app/Fragment.html#setHasOptionsMenu(boolean)">setHasOptionsMenu()</a></code> during <code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code>, to indicate that the fragment
would like to add items to the Options Menu (otherwise, the fragment will not receive a call to
<code><a href="../../reference/android/app/Fragment.html#onCreateOptionsMenu(android.view.Menu, android.view.MenuInflater)">onCreateOptionsMenu()</a></code>).</p>

<p>Any items that you then add to the Options Menu from the fragment are appended to the existing
menu items. The fragment also receives callbacks to <code><a href="../../reference/android/app/Fragment.html#onOptionsItemSelected(android.view.MenuItem)">onOptionsItemSelected()</a></code> when a menu item
is selected.</p>

<p>You can also register a view in your fragment layout to provide a context menu by calling <code><a href="../../reference/android/app/Fragment.html#registerForContextMenu(android.view.View)">registerForContextMenu()</a></code>. When the user opens
the context menu, the fragment receives a call to <code><a href="../../reference/android/app/Fragment.html#onCreateContextMenu(android.view.ContextMenu, android.view.View, android.view.ContextMenu.ContextMenuInfo)">onCreateContextMenu()</a></code>. When the user selects an item, the fragment receives a call to <code><a href="../../reference/android/app/Fragment.html#onContextItemSelected(android.view.MenuItem)">onContextItemSelected()</a></code>.</p>

<p class="note"><strong>Note:</strong> Although your fragment receives an on-item-selected callback
for each menu item it adds, the activity is first to receive the respective callback when the user
selects a menu item. If the activity's implementation of the on-item-selected callback does not
handle the selected item, then the event is passed to the fragment's callback. This is true for
the Options Menu and context menus.</p>

<p>For more information about menus, see the <a
href="../../guide/topics/ui/menus.html">Menus</a> and <a
href="../../guide/topics/ui/actionbar.html">Action Bar</a> developer guides.</p>




<h2 id="Lifecycle">Handling the Fragment Lifecycle</h2>

<div class="figure" style="width:350px">
<img src="../../images/activity_fragment_lifecycle.png" alt=""/>
<p class="img-caption"><strong>Figure 3.</strong> The effect of the activity lifecycle on the fragment
lifecycle.</p>
</div>

<p>Managing the lifecycle of a fragment is a lot like managing the lifecycle of an activity. Like
an activity, a fragment can exist in three states:</p>

<dl>
  <dt><i>恢复状态</i></dt>
    <dd>The fragment is visible in the running activity.</dd>

  <dt><i>暂停状态</i></dt>
    <dd>Another activity is in the foreground and has focus, but the activity in which this
fragment lives is still visible (the foreground activity is partially transparent or doesn't
cover the entire screen).</dd>

  <dt><i>停止状态</i></dt>
    <dd>The fragment is not visible. Either the host activity has been stopped or the
fragment has been removed from the activity but added to the back stack. A stopped fragment is
still alive (all state and member information is retained by the system). However, it is no longer
visible to the user and will be killed if the activity is killed.</dd>
</dl>

<p>Also like an activity, you can retain the state of a fragment using a <code><a href="../../reference/android/os/Bundle.html">Bundle</a></code>, in case the activity's process is killed and you need to restore the
fragment state when the activity is recreated. You can save the state during the fragment's <code><a href="../../reference/android/app/Fragment.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> callback and restore it during
either <code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code>, <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code>, or <code><a href="../../reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">onActivityCreated()</a></code>. For more information about saving
state, see the <a
href="../../guide/components/activities.html#SavingActivityState">Activities</a>
document.</p>

<p>The most significant difference in lifecycle between an activity and a fragment is how one is
stored in its respective back stack. An activity is placed into a back stack of activities
that's managed by the system when it's stopped, by default (so that the user can navigate back
to it with the <em>Back</em> button, as discussed in <a
href="../../guide/components/tasks-and-back-stack.html">Tasks and Back Stack</a>).
However, a fragment is placed into a back stack managed by the host activity only when you
explicitly request that the instance be saved by calling <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> during a transaction that
removes the fragment.</p>

<p>Otherwise, managing the fragment lifecycle is very similar to managing the activity
lifecycle. So, the same practices for <a
href="../../guide/components/activities.html#Lifecycle">managing the activity
lifecycle</a> also apply to fragments. What you also need to understand, though, is how the life
of the activity affects the life of the fragment.</p>

<p class="caution"><strong>Caution:</strong> If you need a <code><a href="../../reference/android/content/Context.html">Context</a></code> object
within your <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code>, you can call <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code>.
However, be careful to call <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> only when the fragment is
attached to an activity. When the fragment is not yet attached, or was detached during the end of
its lifecycle, <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> will return null.</p>


<h3 id="CoordinatingWithActivity">Coordinating with the activity lifecycle</h3>

<p>The lifecycle of the activity in which the fragment lives directly affects the lifecycle of the
fragment, such that each lifecycle callback for the activity results in a similar callback for each
fragment. For example, when the activity receives <code><a href="../../reference/android/app/Activity.html#onPause()">onPause()</a></code>, each
fragment in the activity receives <code><a href="../../reference/android/app/Fragment.html#onPause()">onPause()</a></code>.</p>

<p>Fragments have a few extra lifecycle callbacks, however, that handle unique interaction with the
activity in order to perform actions such as build and destroy the fragment's UI. These additional
callback methods are:</p>

<dl>
  <dt><code><a href="../../reference/android/app/Fragment.html#onAttach(android.app.Activity)">onAttach()</a></code></dt>
    <dd>Called when the fragment has been associated with the activity (the <code><a href="../../reference/android/app/Activity.html">Activity</a></code> is passed in here).</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code></dt>
    <dd>Called to create the view hierarchy associated with the fragment.</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">onActivityCreated()</a></code></dt>
    <dd>Called when the activity's <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method has returned.</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onDestroyView()">onDestroyView()</a></code></dt>
    <dd>Called when the view hierarchy associated with the fragment is being removed.</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onDetach()">onDetach()</a></code></dt>
    <dd>Called when the fragment is being disassociated from the activity.</dd>
</dl>

<p>The flow of a fragment's lifecycle, as it is affected by its host activity, is illustrated
by figure 3. In this figure, you can see how each successive state of the activity determines which
callback methods a fragment may receive. For example, when the activity has received its <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> callback, a fragment in the activity receives no more than
the <code><a href="../../reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">onActivityCreated()</a></code> callback.</p>

<p>Once the activity reaches the resumed state, you can freely add and remove fragments to the
activity. Thus, only while the activity is in the resumed state can the lifecycle of a fragment
change independently.</p>

<p>However, when the activity leaves the resumed state, the fragment again is pushed through its
lifecycle by the activity.</p>




<h2 id="Example">例子</h2>

<p>To bring everything discussed in this document together, here's an example of an activity
using two fragments to create a two-pane layout. The activity below includes one fragment to
show a list of Shakespeare play titles and another to show a summary of the play when selected
from the list. It also demonstrates how to provide different configurations of the fragments,
based on the screen configuration.</p>

<p class="note"><strong>Note:</strong> The complete source code for this activity is available in
<a
href="../../resources/samples/ApiDemos/src/com/example/android/apis/app/FragmentLayout.html"><code>FragmentLayout.java</code></a>.</p>

<p>The main activity applies a layout in the usual way, during <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code>:</p>

<pre>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    setContentView(R.layout.fragment_layout);
}</pre>

<p>The layout applied is <code>fragment_layout.xml</code>:</p>

<pre>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent" android:layout_height="match_parent"&gt;

    &lt;fragment class="com.example.android.apis.app.FragmentLayout$TitlesFragment"
            android:id="@+id/titles" android:layout_weight="1"
            android:layout_width="0px" android:layout_height="match_parent" /&gt;

    &lt;FrameLayout android:id="@+id/details" android:layout_weight="1"
            android:layout_width="0px" android:layout_height="match_parent"
            android:background="?android:attr/detailsElementBackground" /&gt;

&lt;/LinearLayout&gt;</pre>

<p>Using this layout, the system instantiates the <code>TitlesFragment</code> (which lists the play
titles) as soon as the activity loads the layout, while the <code><a href="../../reference/android/widget/FrameLayout.html">FrameLayout</a></code>
(where the fragment for showing the play summary will go) consumes space on the right side of the
screen, but remains empty at first. As you'll see below, it's not until the user selects an item
from the list that a fragment is placed into the <code><a href="../../reference/android/widget/FrameLayout.html">FrameLayout</a></code>.</p>

<p>However, not all screen configurations are wide enough to show both the list of
plays and the summary, side by side. So, the layout above is used only for the landscape
screen configuration, by saving it at <code>res/layout-land/fragment_layout.xml</code>.</p>

<p>Thus, when the screen is in portrait orientation, the system applies the following layout, which
is saved at <code>res/layout/fragment_layout.xml</code>:</p>

<pre>&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent" android:layout_height="match_parent"&gt;
    &lt;fragment class="com.example.android.apis.app.FragmentLayout$TitlesFragment"
            android:id="@+id/titles"
            android:layout_width="match_parent" android:layout_height="match_parent" /&gt;
&lt;/FrameLayout&gt;</pre>

<p>This layout includes only <code>TitlesFragment</code>. This means that, when the device is in
portrait orientation, only the list of play titles is visible. So, when the user clicks a list
item in this configuration, the application will start a new activity to show the summary,
instead of loading a second fragment.</p>

<p>Next, you can see how this is accomplished in the fragment classes. First is <code>TitlesFragment</code>, which shows the list of Shakespeare play titles. This fragment extends <code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code> and relies on it to handle most of the list view work.</p>

<p>As you inspect this code, notice that there are two possible behaviors when the user clicks a
list item: depending on which of the two layouts is active, it can either create and display a new
fragment to show the details in the same activity (adding the fragment to the <code><a href="../../reference/android/widget/FrameLayout.html">FrameLayout</a></code>), or start a new activity (where the fragment can be shown).</p>

<pre>public static class TitlesFragment extends ListFragment {
    boolean mDualPane;
    int mCurCheckPosition = 0;

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
        super.onActivityCreated(savedInstanceState);

        // Populate list with our static array of titles.
        setListAdapter(new ArrayAdapter&lt;String&gt;(getActivity(),
                android.R.layout.simple_list_item_activated_1, Shakespeare.TITLES));

        // Check to see if we have a frame in which to embed the details
        // fragment directly in the containing UI.
        View detailsFrame = getActivity().findViewById(R.id.details);
        mDualPane = detailsFrame != null &amp;&amp; detailsFrame.getVisibility() == View.VISIBLE;

        if (savedInstanceState != null) {
            // Restore last state for checked position.
            mCurCheckPosition = savedInstanceState.getInt("curChoice", 0);
        }

        if (mDualPane) {
            // In dual-pane mode, the list view highlights the selected item.
            getListView().setChoiceMode(ListView.CHOICE_MODE_SINGLE);
            // Make sure our UI is in the correct state.
            showDetails(mCurCheckPosition);
        }
    }

    @Override
    public void onSaveInstanceState(Bundle outState) {
        super.onSaveInstanceState(outState);
        outState.putInt("curChoice", mCurCheckPosition);
    }

    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        showDetails(position);
    }

    /**
     * Helper function to show the details of a selected item, either by
     * displaying a fragment in-place in the current UI, or starting a
     * whole new activity in which it is displayed.
     */
    void showDetails(int index) {
        mCurCheckPosition = index;

        if (mDualPane) {
            // We can display everything in-place with fragments, so update
            // the list to highlight the selected item and show the data.
            getListView().setItemChecked(index, true);

            // Check what fragment is currently shown, replace if needed.
            DetailsFragment details = (DetailsFragment)
                    getFragmentManager().findFragmentById(R.id.details);
            if (details == null || details.getShownIndex() != index) {
                // Make new fragment to show this selection.
                details = DetailsFragment.newInstance(index);

                // Execute a transaction, replacing any existing fragment
                // with this one inside the frame.
                FragmentTransaction ft = getFragmentManager().beginTransaction();
                if (index == 0) {
                    ft.replace(R.id.details, details);
                } else {
                    ft.replace(R.id.a_item, details);
                }
                ft.setTransition(FragmentTransaction.TRANSIT_FRAGMENT_FADE);
                ft.commit();
            }

        } else {
            // Otherwise we need to launch a new activity to display
            // the dialog fragment with selected text.
            Intent intent = new Intent();
            intent.setClass(getActivity(), DetailsActivity.class);
            intent.putExtra("index", index);
            startActivity(intent);
        }
    }
}</pre>

<p>The second fragment, <code>DetailsFragment</code> shows the play summary for the item selected from
the list from <code>TitlesFragment</code>:</p>
 
<pre>public static class DetailsFragment extends Fragment {
    /**
     * Create a new instance of DetailsFragment, initialized to
     * show the text at 'index'.
     */
    public static DetailsFragment newInstance(int index) {
        DetailsFragment f = new DetailsFragment();

        // Supply index input as an argument.
        Bundle args = new Bundle();
        args.putInt("index", index);
        f.setArguments(args);

        return f;
    }

    public int getShownIndex() {
        return getArguments().getInt("index", 0);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState) {
        if (container == null) {
            // We have different layouts, and in one of them this
            // fragment's containing frame doesn't exist.  The fragment
            // may still be created from its saved state, but there is
            // no reason to try to create its view hierarchy because it
            // won't be displayed.  Note this is not needed -- we could
            // just run the code below, where we would create and return
            // the view hierarchy; it would just never be used.
            return null;
        }

        ScrollView scroller = new ScrollView(getActivity());
        TextView text = new TextView(getActivity());
        int padding = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,
                4, getActivity().getResources().getDisplayMetrics());
        text.setPadding(padding, padding, padding, padding);
        scroller.addView(text);
        text.setText(Shakespeare.DIALOGUE[getShownIndex()]);
        return scroller;
    }
}</pre>

<p>Recall from the <code>TitlesFragment</code> class, that, if the user clicks a list item and the
current layout does <em>not</em> include the <code>R.id.details</code> view (which is where the
<code>DetailsFragment</code> belongs), then the application starts the <code>DetailsActivity</code>
activity to display the content of the item.</p>

<p>Here is the <code>DetailsActivity</code>, which simply embeds the <code>DetailsFragment</code> to display
the selected play summary when the screen is in portrait orientation:</p>

<pre>public static class DetailsActivity extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        if (getResources().getConfiguration().orientation
                == Configuration.ORIENTATION_LANDSCAPE) {
            // If the screen is now in landscape mode, we can show the
            // dialog in-line with the list so we don't need this activity.
            finish();
            return;
        }

        if (savedInstanceState == null) {
            // During initial setup, plug in the details fragment.
            DetailsFragment details = new DetailsFragment();
            details.setArguments(getIntent().getExtras());
            getFragmentManager().beginTransaction().add(android.R.id.content, details).commit();
        }
    }
}</pre>
 
<p>Notice that this activity finishes itself if the configuration is landscape, so that the main
activity can take over and display the <code>DetailsFragment</code> alongside the <code>TitlesFragment</code>.
This can happen if the user begins the <code>DetailsActivity</code> while in portrait orientation, but
then rotates to landscape (which restarts the current activity).</p>


<p>For more samples using fragments (and complete source files for this example),
see the API Demos sample app available in <a
href="../../resources/samples/ApiDemos/src/com/example/android/apis/app/index.html#Fragment">
ApiDemos</a> (available for download from the <a
href="../../resources/samples/get.html">Samples SDK component</a>).</p>



    </div>
      
      <div class="content-footer layout-content-row" 
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-8" style="padding-top:4px">
          
            <div class="g-plusone" data-size="medium"></div>
          
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
      

  </div><!-- end jd-content --> 

<div id="footer" class="wrap" >
        

  <div id="copyright">
    
  
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="../../about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../support.html">Support</a>
  </p>
  </div>

</div><!-- end footer --> 
</div><!-- end doc-content -->

</div><!-- end body-content -->  






</body>
</html>



