<!DOCTYPE html>












































































<html>
<head>


<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width" />

<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>活动片段 | 安卓开发者</title><!-- STYLESHEETS --><!-- JAVASCRIPT -->


<link rel="stylesheet"
href="http://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">




<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var devsite = false;
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5831155-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="gc-documentation 
  develop guide" itemscope itemtype="http://schema.org/Article"><!-- Header -->

<a name="top"></a>

    
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 logo">
          <a href="../../index.html">
            <img src="../../assets/images/dac_logo.png" width="123" height="25" alt="Android Developers" />
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
          	<a href="#" class="arrow-inactive">Quicknav</a>
			      <a href="#" class="arrow-active">Quicknav</a>
          </div>
          </div>
            <ul class="nav-x col-9">
                <li class="design">
                  <a href="../../design/index.html"
                  zh-tw-lang="設計"
                  zh-cn-lang="设计"
                  ru-lang="Проектирование"
                  ko-lang="디자인"
                  ja-lang="設計"
                  es-lang="Diseñar"               
                  >设计</a></li>
                <li class="develop"><a href="../../develop/index.html"
                  zh-tw-lang="開發"
                  zh-cn-lang="开发"
                  ru-lang="Разработка"
                  ko-lang="개발"
                  ja-lang="開発"
                  es-lang="Desarrollar"               
                  >开发</a></li>
                <li class="distribute last"><a href="../../distribute/index.html"
                  zh-tw-lang="發佈"
                  zh-cn-lang="分发"
                  ru-lang="Распространение"
                  ko-lang="배포"
                  ja-lang="配布"
                  es-lang="Distribuir"               
                  >分发</a></li>
            </ul><!-- New Search -->
            
            
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="../../about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com">Android Open Source Project</a></li>
      </ul>
      
      
      
      


      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>
  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '../../')" 
onkeyup="return search_changed(event, false, '../../')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  </div><!-- /New Search>
          
          
          <!-- Expanded quicknav -->
  
           <div id="quicknav" class="col-9">
                <ul>
                    <li class="design">
                      <ul>
                        <li><a href="../../design/index.html">入门</a></li>
                        <li><a href="../../design/style/index.html">样式</a></li>
                        <li><a href="../../design/patterns/index.html">设计模式</a></li>
                        <li><a href="../../design/building-blocks/index.html">构造块</a></li>
                        <li><a href="../../design/downloads/index.html">下载</a></li>
                        <li><a href="../../design/videos/index.html">视频</a></li>
                      </ul>
                    </li>
                    <li class="develop">
                      <ul>
                        <li><a href="../../training/index.html"
                          zh-tw-lang="訓練課程"
                          zh-cn-lang="培训"
                          ru-lang="Курсы"
                          ko-lang="교육"
                          ja-lang="トレーニング"
                          es-lang="Capacitación"               
                          >训练课程</a></li>
                        <li><a href="../../guide/components/index.html"
                          zh-tw-lang="API 指南"
                          zh-cn-lang="API 指南"
                          ru-lang="Руководства по API"
                          ko-lang="API 가이드"
                          ja-lang="API ガイド"
                          es-lang="Guías de la API"               
                          >API 指南</a></li>
                        <li><a href="../../reference/packages.html"
                          zh-tw-lang="參考資源"
                          zh-cn-lang="参考"
                          ru-lang="Справочник"
                          ko-lang="참조문서"
                          ja-lang="リファレンス"
                          es-lang="Referencia"               
                          >参考资源</a></li>
                        <li><a href="../../tools/index.html"
                          zh-tw-lang="相關工具"
                          zh-cn-lang="工具"
                          ru-lang="Инструменты"
                          ko-lang="도구"
                          ja-lang="ツール"
                          es-lang="Herramientas"               
                          >开发工具</a>
                          <ul><li><a href="../../sdk/index.html">获取 SDK</a></li></ul>
                        </li>
                        <li><a href="../../google/index.html">Google 服务</a>
                        </li>
                        
                      </ul>
                    </li>
                    <li class="distribute last">
                      <ul>
                        <li><a href="../../distribute/index.html">Google Play 市场</a></li>
                        <li><a href="../../distribute/googleplay/publish/index.html">应用发布</a></li>
                        <li><a href="../../distribute/googleplay/promote/index.html">应用推广</a></li>
                        <li><a href="../../distribute/googleplay/quality/index.html">应用质量</a></li>
                        <li><a href="../../distribute/googleplay/spotlight/index.html">精品聚焦</a></li>
                        <li><a href="../../distribute/open.html">开放发行</a></li>
                      </ul>
                    </li>
                </ul>
          </div><!-- /Expanded quicknav -->
          
        </div>
    </div><!-- /Header -->
    
    
    
  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div><!-- Secondary x-nav -->
    
    
  
    
    <div id="nav-x">
        <div class="wrap">
            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"               
                  >训练课程</a></li>
                <li class="guide"><a href="../../guide/components/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"               
                  >API 指南</a></li>
                <li class="reference"><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"               
                  >参考资源</a></li>
                <li class="tools"><a href="../../tools/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >开发工具</a></li>
                <li class="google"><a href="../../google/index.html"
                  >Google 服务</a>
                </li>
                
            </ul>
        </div>
        
    </div><!-- /Sendondary x-nav -->
    
  




  

  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="#top" data-g-event="left-nav-top">to top</a>



<ul id="nav"><!--  Walkthrough for Developers -- quick overview of what it's like to develop on Android --><!--<li style="color:red">Overview</li> -->
  
  

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/components/index.html">
        <span class="en">应用组件</span>
      </a></div>
    <ul>
      <li><a href="../../guide/components/fundamentals.html">
            <span class="en">应用基本知识</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/activities.html">
            <span class="en">活动</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/fragments.html">
              <span class="en">活动片段</span>
            </a></li>
          <li><a href="../../guide/components/loaders.html">
              <span class="en">加载器</span>
            </a></li>
          <li><a href="../../guide/components/tasks-and-back-stack.html">
              <span class="en">任务和活动堆栈</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/services.html">
            <span class="en">服务</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/bound-services.html">
              <span class="en">绑定服务</span>
            </a></li>
          <li><a href="../../guide/components/aidl.html">
              <span class="en">AIDL</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/providers/content-providers.html">
            <span class="en">内容提供商</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/providers/content-provider-basics.html">
              <span class="en">内容提供商基础</span>
            </a></li>
          <li><a href="../../guide/topics/providers/content-provider-creating.html">
              <span class="en">创建一个内容提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/calendar-provider.html">
              <span class="en">日历提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/contacts-provider.html">
              <span class="en">联系人提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/document-provider.html">
              <span class="en">存储访问框架</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/components/intents-filters.html">
          <span class="en">意图与意图过滤器</span>
        </a></li>
      <li><a href="../../guide/components/processes-and-threads.html">
          <span class="en">进程和线程</span>
        </a>
      </li>
      <li><a href="../../guide/topics/security/permissions.html">
          <span class="en">权限</span>
        </a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/appwidgets/index.html">
            <span class="en">应用小部件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/appwidgets/host.html">
              <span class="en">应用小部件托管</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/manifest/manifest-intro.html">
          <span class="en">安卓项目清单</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/manifest/action-element.html">&lt;action&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-alias-element.html">&lt;activity-alias&gt;</a></li>
          <li><a href="../../guide/topics/manifest/application-element.html">&lt;application&gt;</a></li>
          <li><a href="../../guide/topics/manifest/category-element.html">&lt;category&gt;</a></li>
          <li><a href="../../guide/topics/manifest/compatible-screens-element.html">&lt;compatible-screens&gt;</a></li>
          <li><a href="../../guide/topics/manifest/data-element.html">&lt;data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/grant-uri-permission-element.html">&lt;grant-uri-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/instrumentation-element.html">&lt;instrumentation&gt;</a></li>
          <li><a href="../../guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></li>
          <li><a href="../../guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></li>
          <li><a href="../../guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/path-permission-element.html">&lt;path-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-element.html">&lt;permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-group-element.html">&lt;permission-group&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-tree-element.html">&lt;permission-tree&gt;</a></li>
          <li><a href="../../guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></li>
          <li><a href="../../guide/topics/manifest/receiver-element.html">&lt;receiver&gt;</a></li>
          <li><a href="../../guide/topics/manifest/service-element.html">&lt;service&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-gl-texture-element.html">&lt;supports-gl-texture&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-screens-element.html">&lt;supports-screens&gt;</a></li><!-- ##api level 4## -->
          <li><a href="../../guide/topics/manifest/uses-configuration-element.html">&lt;uses-configuration&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></li><!-- ##api level 4## --> 
          <li><a href="../../guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-permission-element.html">&lt;uses-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></li>
        </ul>
   </li><!-- end of the manifest file -->

    </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/topics/ui/index.html">
        <span class="en">用户界面</span>
      </a></div>
    <ul>
      <li><a href="../../guide/topics/ui/overview.html">
          <span class="en">概述</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/declaring-layout.html">
            <span class="en">布局</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/layout/linear.html">
              <span class="en">线性布局</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/relative.html">
              <span class="en">相对布局</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/layout/grid.html">
              <span class="en">Grid Layout</span>
            </a></li>
       -->
       
          <li><a href="../../guide/topics/ui/layout/listview.html">
              <span class="en">列表视图</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/gridview.html">
              <span class="en">网格视图</span>
            </a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/controls.html">
            <span class="en">输入控件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/controls/button.html">
              <span class="en">按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/text.html">
              <span class="en">文本框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/checkbox.html">
              <span class="en">复选框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/radiobutton.html">
              <span class="en">单选按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/togglebutton.html">
              <span class="en">切换按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/spinner.html">
              <span class="en">下拉列表</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/pickers.html">
              <span class="en">选择器</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/controls/progress.html">
              <span class="en">Seek and Progress Bars</span>
            </a></li>
-->

        </ul>
      </li>
      <li><a href="../../guide/topics/ui/ui-events.html">
          <span class="en">输入事件</span>
        </a></li>
      <li><a href="../../guide/topics/ui/menus.html">
          <span class="en">菜单</span></span>
          </a></li>
      <li><a href="../../guide/topics/ui/actionbar.html">
           <span class="en">操作栏</span>
          </a></li>
      <li><a href="../../guide/topics/ui/settings.html">
            <span class="en">设置</span>
          </a></li>
      <li><a href="../../guide/topics/ui/dialogs.html">
           <span class="en">对话框</span>
          </a></li>
      <li><a href="../../guide/topics/ui/notifiers/notifications.html">
          <span class="en">通知</span>
        </a></li>
      <li><a href="../../guide/topics/ui/notifiers/toasts.html">
          <span class="en">提醒框</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/search/index.html">
            <span class="en">搜索</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/search/search-dialog.html">创建一个搜索界面</a></li>
            <li><a href="../../guide/topics/search/adding-recent-query-suggestions.html">添加最近查询建议</a></li>
            <li><a href="../../guide/topics/search/adding-custom-suggestions.html">添加自定义建议</a></li>
            <li><a href="../../guide/topics/search/searchable-config.html">可搜索配置</a></li>
          </ul>
      </li>
      <li><a href="../../guide/topics/ui/drag-drop.html">
          <span class="en">拖放</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/accessibility/index.html">
            <span class="en">辅助功能</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/accessibility/apps.html">
              <span class="en">让应用可访问</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/checklist.html">
              <span class="en">辅助功能开发者清单</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/services.html">
              <span class="en">构建辅助功能服务</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/ui/themes.html">
          <span class="en">样式与主题</span>
        </a></li>
      <li><a href="../../guide/topics/ui/custom-components.html">
          <span class="en">自定义组件</span>
        </a></li>
    </ul>
  </li><!-- end of User Interface -->

    <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/resources/index.html">
           <span class="en">应用资源</span>
         </a></div>
      <ul>
        <li><a href="../../guide/topics/resources/overview.html">
            <span class="en">概述</span>
          </a></li>
          <li><a href="../../guide/topics/resources/providing-resources.html">
            <span class="en">提供资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/accessing-resources.html">
            <span class="en">访问资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/runtime-changes.html">
              <span class="en">处理运行时更改</span>
            </a></li>
        <li><a href="../../guide/topics/resources/localization.html">
            <span class="en">本地化</span>
          </a></li>
        <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/resources/available-resources.html">
              <span class="en">资源类型</span>
            </a></div>
          <ul>
            <li><a href="../../guide/topics/resources/animation-resource.html">动画</a></li>
            <li><a href="../../guide/topics/resources/color-list-resource.html">颜色状态列表</a></li>
            <li><a href="../../guide/topics/resources/drawable-resource.html">可描绘资源</a></li>
            <li><a href="../../guide/topics/resources/layout-resource.html">布局</a></li>
            <li><a href="../../guide/topics/resources/menu-resource.html">菜单</a></li>
            <li><a href="../../guide/topics/resources/string-resource.html">字符串</a></li>
            <li><a href="../../guide/topics/resources/style-resource.html">样式</a></li>
            <li><a href="../../guide/topics/resources/more-resources.html">更多类型</a></li>
          </ul>
        </li><!-- end of resource types -->
      </ul>
    </li><!-- end of app resources -->

   <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/graphics/index.html">
          <span class="en">动画与图形</span>
        </a></div>
      <ul>
      <li class="nav-section">
        </li><li><a href="../../guide/topics/graphics/overview.html">
            <span class="en">概述</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/prop-animation.html">
            <span class="en">属性动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/view-animation.html">
            <span class="en">补间动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/drawable-animation.html">
            <span class="en">帧动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/2d-graphics.html">
            <span class="en">画布与图形</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/opengl.html">
            <span class="en">OpenGL ES</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/hardware-accel.html">
            <span class="en">硬件加速</span>
          </a></li>
       </ul>
    </li><!-- end of graphics and animation-->

   <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/topics/renderscript/index.html">
              <span class="en">计算</span>
            </a></div>
            <ul>
              <li><a href="../../guide/topics/renderscript/compute.html">
                    <span class="en">RenderScript</span></a>
                  </li>

              <li><a href="../../guide/topics/renderscript/advanced.html">
                    <span class="en">RenderScript 进阶</span></a>
                  </li>
              <li><a href="../../guide/topics/renderscript/reference.html">
                    <span class="en">运行时 API 参考</span></a>
              </li>
             </ul>
   </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/media/index.html">
            <span class="en">多媒体与照相机</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/media/mediaplayer.html">
                  <span class="en">多媒体播放</span></a>
                </li>
            <li><a href="../../guide/appendix/media-formats.html">
                   <span class="en">支持的多媒体格式</span></a>
                </li>
            <li><a href="../../guide/topics/media/audio-capture.html">
                  <span class="en">音频录制</span></a>
                </li>
            <li><a href="../../guide/topics/media/jetplayer.html">
                  <span class="en">JetPlayer</span></a>
                </li>
            <li><a href="../../guide/topics/media/camera.html">
                  <span class="en">照相机</span></a>
                </li>
          </ul>
      </li><!-- end of media and camera -->

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/sensors/index.html">
              <span class="en">位置与传感器</span>
              </a></div>
        <ul>
          <li><a href="../../guide/topics/location/index.html">
               <span class="en">位置和地图</span>
             </a>
          </li><li><a href="../../guide/topics/location/strategies.html">
               <span class="en">位置策略</span>
             </a></li>
          <li><a href="../../guide/topics/sensors/sensors_overview.html">
              <span class="en">传感器概述</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_motion.html">
              <span class="en">动作传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_position.html">
              <span class="en">位置传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_environment.html">
              <span class="en">环境传感器</span>
            </a></li>
        </ul>
      </li><!-- end of location and sensors -->



<li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/index.html">
               <span class="en">连接性</span>
             </a></div>
        <ul>
          <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/bluetooth.html">
          <span class="en">蓝牙</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/bluetooth-le.html">低功耗蓝牙</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/nfc/index.html">
          <span class="en">NFC</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/nfc/nfc.html">NFC 基础</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/advanced-nfc.html">高级 NFC</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/hce.html">Host-based Card Emulation</a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/connectivity/wifip2p.html">
            <span class="en">Wi-Fi P2P</span></a>
          </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/connectivity/usb/index.html">
            <span class="en">USB</span></a>
          </div>
            <ul>
              <li><a href="../../guide/topics/connectivity/usb/accessory.html">附件</a></li>
              <li><a href="../../guide/topics/connectivity/usb/host.html">主机</a></li>
            </ul>
     </li>
     <li><a href="../../guide/topics/connectivity/sip.html">
            <span class="en">SIP</span>
          </a>
     </li>

    </ul>
  </li><!-- end of connectivity -->


      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/text/index.html">
            <span class="en">文本与输入</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/text/copy-paste.html">
              <span class="en">复制和粘贴</span>
            </a></li>
          <li><a href="../../guide/topics/text/creating-input-method.html">
              <span class="en">创建输入法引擎</span>
            </a></li>
          <li><a href="../../guide/topics/text/spell-checker-framework.html">
              <span class="en">拼写检查</span>
            </a></li>
        </ul>
      </li><!-- end of text and input -->

     <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/data/index.html">
          <span class="en">数据存储</span>
        </a></div>
      <ul>
         <li><a href="../../guide/topics/data/data-storage.html">
            <span class="en">存储选项</span>
           </a></li>
        <li><a href="../../guide/topics/data/backup.html">
            <span class="en">数据备份</span>
          </a></li>
        <li><a href="../../guide/topics/data/install-location.html">
            <span class="en">应用安装位置</span>
          </a></li>
      </ul>
    </li><!-- end of data storage -->


  <li class="nav-section">
           <div class="nav-section-header"><a href="../../guide/topics/admin/index.html">
               <span class="en">管理</span>
             </a></div>
           <ul>
              <li>
                <a href="../../guide/topics/admin/device-admin.html">
                <span class="en">设备管理</span></a>
              </li><!--
              <li>
                <a href="../../guide/topics/admin/keychain.html">
                <span class="en">Certificate Store</span></a>
              </li>
            -->
            
           </ul>
  </li><!-- end of administration -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/webapps/index.html">
    <span class="en">Web 应用</span>
    </a></div>
    <ul>
      <li><a href="../../guide/webapps/overview.html">
            <span class="en">概述</span>
          </a></li>
      <li><a href="../../guide/webapps/targeting.html">
            <span class="en">Web 应用的目标屏幕</span>
          </a></li>
      <li><a href="../../guide/webapps/webview.html">
            <span class="en">在 WebView 中创建 Web 应用</span>
          </a></li>
      <li><a href="../../guide/webapps/migrating.html">
            <span class="en">迁移到 Android 4.4 版本的 WebView</span>
          </a></li>
      <li><a href="../../guide/webapps/debugging.html">
            <span class="en">Web 应用调试</span>
          </a></li>
      <li><a href="../../guide/webapps/best-practices.html">
            <span class="en">Web 应用的最佳实践</span>
          </a></li>
    </ul>
  </li><!-- end of web apps -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/practices/index.html">
      <span class="en">最佳实践</span> <span class="de" style="display:none">Bewährte Verfahren</span> <span class="es" style="display:none">Prácticas recomendadas</span> <span class="fr" style="display:none">Meilleures pratiques</span> <span class="it" style="display:none">Best practice</span> <span class="ja" style="display:none">ベスト プラクティス</span> <span class="zh-cn" style="display:none">最佳实践</span> <span class="zh-tw" style="display:none">最佳實務</span>
    </a></div></a>
    <ul>
      <li><a href="../../guide/practices/compatibility.html">
            <span class="en">兼容性</span>
          </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/screens_support.html">
          <span class="en">支持多个屏幕</span>
        </a></div>
        <ul>
          <li><a href="../../guide/practices/screens-distribution.html">
            <span class="en">分发给特定的屏幕</span>
          </a></li>
          <li><a href="../../guide/practices/screen-compat-mode.html">
            <span class="en">屏幕兼容性模式</span>
          </a></li>
        </ul>
      </li>
      <li><a href="../../guide/practices/tablets-and-handsets.html">
            <span class="en">支持平板设备和手持设备</span>
          </a></li>

    </ul>
  </li><!-- this needs to move
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/index.html">
               <span class="en">UI Guidelines</span>
             </a></div>
        <ul>
          <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/icon_design.html">
                   <span class="en">Icon Design</span>
                 </a></div>
            <ul>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_launcher.html">
                    <span class="en">Launcher Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_menu.html">
                    <span class="en">Menu Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_action_bar.html">
                    <span class="en">Action Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_status_bar.html">
                    <span class="en">Status Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_tab.html">
                    <span class="en">Tab Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_dialog.html">
                    <span class="en">Dialog Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_list.html">
                    <span class="en">List View Icons</span>
                  </a></li>
            </ul>
          </li>
          <li><div><a href="../../guide/practices/ui_guidelines/widget_design.html">
                <span class="en">App Widget Design</span>
              </a></div>
          </li>
        </ul>
      </li>
        </ul> --><!-- Remove
  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/appendix/index.html">
        <span class="en">Appendix</span>
        <span class="de" style="display:none">Anhang</span>
        <span class="es" style="display:none">Apéndice</span>
        <span class="fr" style="display:none">Annexes</span>
        <span class="it" style="display:none">Appendice</span>
        <span class="ja" style="display:none">付録</span>
        <span class="zh-cn" style="display:none">附录</span>
        <span class="zh-tw" style="display:none">附錄</span>
      </a></div>
    <ul>
      <li><a href="../../guide/appendix/g-app-intents.html">
            <span class="en">Intents List: Google Apps</span>
          </a></li>


      <li><a href="../../guide/appendix/glossary.html">
            <span class="en">Glossary</span>
          </a></li>
    </ul>
  </li>

</li>
-->

      


</ul>


<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>


        

      </div>
    </div><!-- end side-nav --> 
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >活动片段</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
<div id="qv">

  <h2>要点</h2>
  <ul>
    <li>活动碎片将应用功能和用户界面分解成可复用的模块</li>
    <li>在屏幕中添加多个活动碎片来避免切换活动组件</li>
    <li>活动碎片有它们自己的生命周期、状态和返回栈</li>
    <li>活动碎片需要 API Level 11 或更高级别</li>
  </ul>

  <h2>在本文档中</h2>
  <ol>
    <li><a href="#Design">设计理念</a></li>
    <li><a href="#Creating">创建活动片段</a>
      <ol>
        <li><a href="#UI">添加用户界面</a></li>
        <li><a href="#Adding">添加活动片段到活动组件</a></li>
      </ol>
    </li>
    <li><a href="#Managing">管理活动碎片</a></li>
    <li><a href="#Transactions">执行活动碎片事务</a></li>
    <li><a href="#CommunicatingWithActivity">与活动组件通信</a>
      <ol>
        <li><a href="#EventCallbacks">给活动组件创建事件回调</a></li>
        <li><a href="#ActionBar">在操作栏中添加项目</a></li>
      </ol>
    </li>
    <li><a href="#Lifecycle">处理活动碎片生命周期</a>
      <ol>
        <li><a href="#CoordinatingWithActivity">与活动生命周期协调</a></li>
      </ol>
    </li>
    <li><a href="#Example">例子</a></li>
  </ol>

  <h2>关键类</h2>
  <ol>
    <li><code><a href="../../reference/android/app/Fragment.html">Fragment</a></code></li>
    <li><code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code></li>
    <li><code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code></li>
  </ol>
  
  <h2>参考</h2>
  <ol>
    <li><a href="../../training/basics/fragments/index.html">使用活动片段创建动态界面</a></li>
    <li><a href="../../guide/practices/tablets-and-handsets.html">支持平板设备和手持设备</a></li>
  </ol>
</div>
</div>

<p>在<code><a href="../../reference/android/app/Activity.html">活动组件</a></code>中，一个<code><a href="../../reference/android/app/Fragment.html">活动碎片</a></code>代表一个动作或者用户界面的一部分。你可以在单个活动中组织多个活动片段，用以创建一个多面板的用户界面和在多个活动中重用一个活动片段。你可以把一个活动片段当作一个模块化的活动，它有自己的生命周期并接受自身的输入事件，同时这些活动片段在活动运行时还可以进行添加和移除。（有点像一个可以在不同活动中重复使用的“子活动”）。</p>

<p>一个活动片段必须嵌入一个活动中，活动片段的生命周期受到它宿主活动生命周期的直接影响。例如，当一个活动暂停时，它托管的所有活动片段也都没暂停，当宿主活动被销毁时，它里面的所有活动片段都同时被销毁。然而，当一个活动正在运行时（处于<em>恢复状态</em> <a
href="../../guide/components/activities.html#Lifecycle">生命周期</a>），此时你可以独立每个操作托管的活动片段，例如添加或者移除它们。当执行这样的活动片段事务，你也可以把它添加在宿主活动管理的返回栈中 — 进入宿主活动返回栈是一条已发生的活动片段事务记录。通过点击<em>返回</em>按钮，返回栈允许用户返回到一个活动片段事务（向后导航）。</p>

<p>当你在活动布局中添加一个活动片段，它托管在活动视图层次的<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>中。通过在活动布局文件中声明活动片段，使用 <code>&lt;fragment&gt;</code> 元素，你可以在活动布局中插入一个活动片段，或者在你应用程序的代码中，把活动片段添加到一个已经存在的<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>。然而，活动片段并不是只托管在活动中，你也可以在没有它自己用户界面的情况下使用活动片段，这时活动在活动中不可见。</p>

<p>本文档介绍了使用活动片段如何创建你的应用程序。包括了添加在活动返回栈中的活动片段如何维护它们的状态、如何与活动和其他托管在相同活动的活动片段共享事件、创建活动的活动指示条等。</p>


<h2 id="Design">设计理念</h2>

<p>安卓系统在 Android 3.0 (API level 11) 中引进了活动片段，目的是在大屏幕设备中支持更多的动态和灵活的用户界面，例如在平板电脑中。由于平板电脑的屏幕比手持设备大很多，从而组合以及切换组件的空间更大。活动片段允许你简洁的设计，其不需要你管理复杂的视图层次结构改变。通过把一个活动的布局切分为多个活动片段，在活动运行时可以修改它的外形，并且把这些改变保存在宿主活动管理的返回栈中。</p>

<p>例如，有一个新闻的应用程序。它有在屏幕的左边显示文中的列表的活动片段和在右边显示文章内容的另外一个活动片段，这两个活动片段在同一个活动中显示，而每一个活动片段都有其自身生命周期回调方法的集合并处理它们自身的用户输入事件。所以，用户可以在用一个活动中选择一篇文章并阅读，而不是使用一个活动选择需要阅读的文章题目和另外一个活动阅读文章的内容，就像图一所示的一个平板电脑布局。</p>

<p>你应把每一个活动片段设计为一个组件模块、或者是一个可重复使用的活动组件。这意味着，由于每一个活动片段定义在一个自身独立的布局中并且控制生命周期的控制自身的行为，你可以在多个活动中引用同一个活动片段，所以你可以将活动片段设计为可重用和避免从另外的活动片段中直接操作一个活动片段。这时非常重要的，因为一个活动片段模块允许你为不同大小的屏幕改变你活动片段组合。当要把你的应用程序设计为兼容平板电脑和手持设备时，结合用户的设备屏幕大小，迎合用户的体验，你可以在不同的布局配置文件中重用你的活动片段。例如在一个手持设备中，因为多个活动片段在同一个活动中不能兼容，可能需要提供一个单面板的用户界面而把这些活动片段切分。</p>

<img src="../../images/fundamentals/fragments.png" alt="" />
<p class="img-caption"><strong>图 1.</strong>通过活动片段定义的两个用户界面模块的例子，在平板电脑中组合在一起，但为手持设备设计时将两个活动组件分开。</p>

<p>举例来说 — 在新闻应用的例子中 — 应用可以当运行在平板尺寸的设备上时在<em>活动 A</em>中内嵌两个活动碎片。但是，当在手持尺寸屏幕中，没有足够空间同时显示两个活动碎片，于是<em>活动 A</em>只包含显示文章列表的活动碎片，而当用户选择一个文章时，它启动<em>活动 B</em>，在活动 B 中包括阅读文章内容的第二个活动酥皮。这样，应用通过在不同组合中重用活动碎片来同时支持平板设备和手持设备，如图 1 中所显示。</p>

<p>更多关于使用不同活动碎片组合来为不同屏幕配置而设计应用的信息，查看<a
href="../../guide/practices/tablets-and-handsets.html">支持平板设备和手持设备</a>指南。</p>



<h2 id="Creating">创建活动片段</h2>

<div class="figure" style="width:327px">
<img src="../../images/fragment_lifecycle.png" alt="" />
<p class="img-caption"><strong>图 2.</strong> 活动碎片生命周期（当活动运行时）。</p>
</div>

<p>要创建活动碎片，你必须创建一个 <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 子类（或者它的其它子类）。<code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 类包含和 <code><a href="../../reference/android/app/Activity.html">Activity</a></code> 相似的代码。它包含类似于活动类的回调函数，如 <code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code> 方法，<code><a href="../../reference/android/app/Fragment.html#onStart()">onStart()</a></code> 方法，<code><a href="../../reference/android/app/Fragment.html#onPause()">onPause()</a></code> 方法和 <code><a href="../../reference/android/app/Fragment.html#onStop()">onStop()</a></code> 方法。事实上，如果你转换一个现有的安卓应用来使用活动碎片，你可能还需要简单地将活动回调方法中的代码移动到活动碎片中相应的回调函数中。</p>

<p>通常你需要实现至少这些生命周期方法：</p>

<dl>
  <dt><code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code></dt>
  <dd>当系统创建活动碎片时调用这个方法。在你的实现中，你应该初始化那些你希望在活动碎片暂停或停止状态及恢复状态中希望保留的关键组件。</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code></dt>
  <dd>当系统初次绘制活动碎片的用户界面时调用这个方法。要绘制活动碎片的用户界面，你必须在这个方法中返回一个 <code><a href="../../reference/android/view/View.html">View</a></code> 类，而它是活动碎片的根布局视图。如果活动碎片不提供用户界面，你可以返回 null。</dd>
  <dt><code><a href="../../reference/android/app/Activity.html#onPause()">onPause()</a></code></dt>
  <dd>系统在用户离开活动碎片时（并不表示活动碎片要被销毁）调用这个方法。因为用户可能不会返回该活动，在这个回调中你应该提交所有应持久化的改变，让这些改变能在下次用户回话中仍生效。</dd>
</dl>

<p>大多数应用应该为每一个活动碎片至少实现这三个方法，但是你可以使用一些其他的回调方法来处理活动碎片生命周期的各种阶段。所有关于生命周期回调方法的细节将会在<a href="#Lifecycle">处理活动碎片周期</a>小节中讨论。</p>


<p>有一些你可能希望继承的 <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 类的子类：</p>

<dl>
  <dt><code><a href="../../reference/android/app/DialogFragment.html">DialogFragment</a></code></dt>
  <dd>显示一个浮动对话框。使用这个类创建对话框是一个好的替代来使用 <code><a href="../../reference/android/app/Activity.html">Activity</a></code> 类的对话框辅助方法，因为你可以将活动碎片对话框结合进由活动管理的活动碎片返回栈，折让用户可以返回到一个取消的活动碎片。</dd>

  <dt><code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code></dt>
  <dd>显示一个由适配器管理的项目列表（如 <code><a href="../../reference/android/widget/SimpleCursorAdapter.html">SimpleCursorAdapter</a></code>），类似于 <code><a href="../../reference/android/app/ListActivity.html">ListActivity</a></code>类。它提供一些管理列表视图的方法，如 <code><a href="../../reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">onListItemClick()</a></code> 回调方法类处理单击事件。</dd>

  <dt><code><a href="../../reference/android/preference/PreferenceFragment.html">PreferenceFragment</a></code></dt>
  <dd>用列表显示一个 <code><a href="../../reference/android/preference/Preference.html">Preference</a></code> 对象的层次结构，类似于 <code><a href="../../reference/android/preference/PreferenceActivity.html">PreferenceActivity</a></code> 类。这在创建一个应用的”设置“活动很有用。</dd>
</dl>


<h3 id="UI">添加用户界面</h3>

<p>活动片段通常用作活动用户界面的一部分，它为活动组件贡献自己部分的布局。</p>

<p>要给活动片段提供一个布局，你必须实现 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 回调方法，当活动片段绘制它的布局时安卓系统会调用这个方法。这个方法的实现必须返回一个 <code><a href="../../reference/android/view/View.html">View</a></code> 对象，它是你的活动片段布局的根视图。</p>

<p class="note"><strong>注意：</strong> 如果活动片段是 <code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code> 的子类，默认实现从 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法返回一个 <code><a href="../../reference/android/widget/ListView.html">ListView</a></code> 类 , 这样你不需要实现它。</p>

<p>要从 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code>方法返回一个布局，你可以从用 XML 语言定义的<a
href="../../guide/topics/resources/layout-resource.html">布局资源</a>来填充它。为了帮助你，<code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法提供了一个 <code><a href="../../reference/android/view/LayoutInflater.html">LayoutInflater</a></code> 对象。</p>

<p>例如，这里是一个 <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 子类，它从 <code>example_fragment.xml</code> 文件中加载一个布局：</p>

<pre>
public static class ExampleFragment extends Fragment {
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.example_fragment, container, false);
    }
}
</pre>

<div class="sidebox-wrapper">
<div class="sidebox">
  <h3>创建布局</h3>
  <p>在上面的例子中，<code>R.layout.example_fragment</code> 是对保存在应用资源的 <code>example_fragment.xml</code> 文件的引用。更多如何使用 XML 语言创建布局的信息，查看<a href="../../guide/topics/ui/index.html">用户界面</a>文档。</p>
</div>
</div>

<p>传递给 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法的 <code>container</code>  参数是是父<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>（来自活动布局），你的活动片段布局将插入到这里。<code>savedInstanceState</code> 参数是一个 <code><a href="../../reference/android/os/Bundle.html">Bundle</a></code>，当活动片段恢复时它提供之前活动片段实例数据（关于恢复状态会在<a href="#Lifecycle">处理活动片段生命周期</a>小节中有更多讨论）。</p>

<p><code><a href="../../reference/android/view/LayoutInflater.html#inflate(int, android.view.ViewGroup, boolean)">inflate()</a></code> 方法带有三个参数：</p>
<ul>
  <li>你希望填充的资源 ID。</li>
  <li>被填充布局的父<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>。传入的 <code>container</code> 参数对系统将布局应用到被填充布局的主视图上非常重要，这个参数由父视图指定。</li>
  <li>一个布尔值表示被填充的布局当填充时是否应该附加到<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>上（第二个参数）。(在这个例子中，这个参数设置为 false 因为系统已经将被填充的视图插入到 <code>container</code> 中，而传 true 值会在最终布局中创建一个多余的视图组。）</li>
</ul>

<p>现在你已经看到如何创建一个提供布局的活动片段。下一步，你需要添加活动片段到你的活动组件中。</p>



<h3 id="Adding">添加活动片段到活动组件</h3>

<p>通常，活动片段向活动宿主提供一部分用户界面，它作为活动组件的整体视图结构的一部分嵌入。有两种方法添加一个活动片段到活动布局中：</p>

<ul>
  <li><b>在活动布局文件中声明活动片段。</b>
<p>在这种情况中，你可以用类似声明视图的方法指定布局属性为活动片段。例如，下面是一个带两个活动片段的活动组件的布局文件：</p>
<pre>
<?xml version="1.0" encoding="UTF-8"?>
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;fragment android:name="com.example.news.ArticleListFragment"
            android:id="@+id/list"
            android:layout_weight="1"
            android:layout_width="0dp"
            android:layout_height="match_parent" /&gt;
    &lt;fragment android:name="com.example.news.ArticleReaderFragment"
            android:id="@+id/viewer"
            android:layout_weight="2"
            android:layout_width="0dp"
            android:layout_height="match_parent" /&gt;
&lt;/LinearLayout&gt;
</pre>
  <p><code>&lt;fragment&gt;</code> 节点的 <code>android:name</code> 指定 <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> 类来实例化布局。</p>

<p>当系统创建这个活动布局，它实例化每一个布局中指定的活动片段并调用各自的 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法来获得每个活动偏度的布局。系统将活动片段返回的<code><a href="../../reference/android/view/View.html">视图</a></code>直接插入到 <code>&lt;fragment&gt;</code> 元素的位置。</p>

<div class="note">
  <p><strong>注意：</strong>每一个活动片段都需要一个独立的标识符，如果宿主活动被重启时，系统使用标识符恢复活动片段（你也可以通过标识符捕捉到指定的活动片段执行事务）。有三种方法为活动片段提供 ID：</p>
  <ul>
    <li>为 <code>android:id</code> 属性提供一个唯一的 ID。</li>
    <li>为 <code>android:tag</code> 提供一个唯一的字符串。</li>
    <li>如果你不使用前两种方法的任何一种，系统使用容器视图的 ID。</li>
  </ul>
</div>
  </li>

  <li><b>或者，以编程的方式把活动片段添加到一个已存在的<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>中。</b>
<p>在你活动运行期间的任意时间，你可以在活动布局中添加活动片段。你仅仅需要指定活动片段的宿主<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>即可。</p>
  <p>要想在你的活动中执行事务（例如添加，移除或者替换一个活动片段），你必须使用 <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code> API。你可以像下面代码一样，从你的<code><a href="../../reference/android/app/Activity.html">活动</a></code>中获取一个<code><a href="../../reference/android/app/FragmentTransaction.html">活动片段事务</a></code>的实例：</p>

<pre>
FragmentManager fragmentManager = <code><a href="../../reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code>
FragmentTransaction fragmentTransaction = fragmentManager.<code><a href="../../reference/android/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code>;
</pre>

<p>使用 <code><a href="../../reference/android/app/FragmentTransaction.html#add(int, android.app.Fragment)">add()</a></code> 方法，你可以添加一个活动片段，指定要添加的活动对象和宿主视图。例如：</p>

<pre>
ExampleFragment fragment = new ExampleFragment();
fragmentTransaction.add(R.id.fragment_container, fragment);
fragmentTransaction.commit();
</pre>

  <p>在 <code><a href="../../reference/android/app/FragmentTransaction.html#add(int, android.app.Fragment)">add()</a></code> 方法中，第一个参数是活动片段托管的<code><a href="../../reference/android/view/ViewGroup.html">视图组</a></code>，这个视图组通过资源 ID 指定，第二个参数是添加指定的活动片段。</p>
  <p>一旦使用<code><a href="../../reference/android/app/FragmentTransaction.html">活动片段事务</a></code>做出改变之后，你必须调用 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法让作出的改变生效。</p>
  </li>
</ul>


<h4 id="AddingWithoutUI">添加一个没有用户界面的活动片段</h4>

<p>上面所给出的例子都是为了提供一个用户界面，应怎样在你的活动中添加一个活动片段。然而，你也可以为没有呈现额外用户界面的活动添加一个活动片段，这些活动片段在后台中执行动作。</p>

<p>添加一个没有用户界面的活动片段，需使用 <code><a href="../../reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">add(Fragment, String)</a></code>（为活动片段提供一个标签字符串，而不是一个视图ID）从活动中添加活动片段。添加活动片段之后，但是，由于它没有在活动布局中关联一个视图，它不会接收 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法调用。所以你不必实现这个方法。</p>

<p>为活动片段提供一个字符串标签并不完全应用于没有用户界面的活动片段——你也可以为有用户界面的活动片段提供字符串标签——但如果活动片段没有用户界面，字符串标签是识别该活动片段的唯一途径。稍后如果你想从活动中获取这个活动片段，你需要使用 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">findFragmentByTag()</a></code> 方法。</p>

<p>查看 <a
href="../../resources/samples/ApiDemos/src/com/example/android/apis/app/FragmentRetainInstance.html"><code>FragmentRetainInstance.java</code></a> 范例，它使用一个没有用户界面的活动片段在后台工作。</p>



<h2 id="Managing">管理活动碎片</h2>

<p>为了管理你活动中的活动片段，你需要使用 <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> 类。调用活动的 <code><a href="../../reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code> 方法可以获取活动片段管理器。</p>

<p>在<code><a href="../../reference/android/app/FragmentManager.html">活动片段管理器</a></code>中，你可以有如下几种操作：</p>

<ul>
  <li>使用 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentById(int)">findFragmentById()</a></code> 方法（对于在活动布局中提供一个用户界面的活动片段）或者 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">findFragmentByTag()</a></code> 方法（对于提供或者不提供一个用户界面的活动片段），来在活动中获取已经存在的活动片段。</li> 
  <li>使用 <code><a href="../../reference/android/app/FragmentManager.html#popBackStack()">popBackStack()</a></code> 方法来让活动片段出栈（模拟用户的<em>返回</em>命令）。</li>
  <li>使用 <code><a href="../../reference/android/app/FragmentManager.html#addOnBackStackChangedListener(android.app.FragmentManager.OnBackStackChangedListener)">addOnBackStackChangedListener()</a></code> 方法来为返回栈的改变事件注册一个监听器。</li>
</ul>

<p>更多关于这些方法以及其它相关信息，请查看<code><a href="../../reference/android/app/FragmentManager.html">活动片段管理器</a></code>类的文档。</p>

<p>正如之前所展示的，你可以使用<code><a href="../../reference/android/app/FragmentManager.html">活动片段管理器</a></code>打开一个<code><a href="../../reference/android/app/FragmentTransaction.html">活动片段事务</a></code>，它让你可以执行事务操作，如添加和删除活动片段。</p>


<h2 id="Transactions">执行活动碎片事务</h2>

<p>在活动中使用活动碎片的主要功能包括添加、删除、替换活动碎片，以及相应用户交互的其他活动碎片相关操作。向活动提交的每一组变更都称作一个事务，你可以使用 <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code> 中的 API 来执行事务操作。你也可以把每一个事务操作保存到由活动管理的返回栈中，它让用户可以返回到之前的活动碎片变更状态（类似于活动向后导航）。</p>

<p>你可以像这样从 <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> 获取 <code><a href="../../reference/android/app/FragmentTransaction.html">FragmentTransaction</a></code>：</p>

<pre>
FragmentManager fragmentManager = <code><a href="../../reference/android/app/Activity.html#getFragmentManager()">getFragmentManager()</a></code>;
FragmentTransaction fragmentTransaction = fragmentManager.<code><a href="../../reference/android/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code>;
</pre>

<p>每一个事务操作都是一组你希望同时执行的变更。你可以使用像 <code><a href="../../reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">add()</a></code>、<code><a href="../../reference/android/app/FragmentTransaction.html#remove(android.app.Fragment)">remove()</a></code> 和 <code><a href="../../reference/android/app/FragmentTransaction.html#replace(int, android.app.Fragment)">replace()</a></code> 这些方法来设置你希望在某个事务中执行的所有变化。然后要将这个事务操作应用到活动，你需要调用 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法。</p>
</dl>

<p>在你调用 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法前，你可能会调用 <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> 方法来将事务添加到活动碎片事务的返回栈中。返回栈由活动管理，它让用户当按下<em>返回</em>按钮时可以返回到之前活动碎片状态。</p>

<p>例如，下面这段代码说明你如何替换一个活动碎片并将替换前状态保存到返回栈中：</p>

<pre>
// Create new fragment and transaction
Fragment newFragment = new ExampleFragment();
FragmentTransaction transaction = getFragmentManager().beginTransaction();

// Replace whatever is in the fragment_container view with this fragment,
// and add the transaction to the back stack
transaction.replace(R.id.fragment_container, newFragment);
transaction.addToBackStack(null);

// Commit the transaction
transaction.commit();
</pre>

<p>在这个例子中，<code>newFragment</code> 方法替换当前布局容器中由 <code>R.id.fragment_container</code> ID 识别的活动碎片。通过调用 <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> 方法，替换事务操作被保存到返回栈中，这样用户可以保留这个事务并当按下<em>返回</em>按钮后能回到前一个活动碎片。</p>

<p>如果你添加多个更改到事务中（如另一个 <code><a href="../../reference/android/app/FragmentTransaction.html#add(android.app.Fragment, java.lang.String)">add()</a></code> 或 <code><a href="../../reference/android/app/FragmentTransaction.html#remove(android.app.Fragment)">remove()</a></code> 操作）并调用 <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> 方法，那么所有 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法调用前应用的更改都会作为一个事务添加到返回栈中，而 <em>返回</em>按钮会将它们同时恢复。</p>

<p>你在<code><a href="../../reference/android/app/FragmentTransaction.html">活动碎片事务</a></code>中添加更改的顺序不重要，除了：</p>
<ul>
  <li>你必须最后调用 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法</li>
  <li>如果你添加多个活动碎片到同一个容器中，那么它们的添加顺序决定了它们在视图层级中的显示顺序</li>
</ul>

<p>如果你在执行删除事务操作时不调用 <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> 方法，那么被删除的活动碎片会在事务提交后销毁，用户也不能再次访问它。然后，当你在删除一个活动碎片时调用 <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> 方法，那么该活动碎片会<em>停止</em>并在用户返回时恢复。</p>

<p class="note"><strong>提示：</strong>对每一个活动碎片事务，你可以在提交前调用 <code><a href="../../reference/android/app/FragmentTransaction.html#setTransition(int)">setTransition()</a></code> 方法来设置转换动画。</p>

<p>调用 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法不会直接执行事务操作。它会在活动 UI 线程（“主”线程）可用的时候安排事务操作在该线程上运行。如果需要，你可以在 UI 线程中调用 <code><a href="../../reference/android/app/FragmentManager.html#executePendingTransactions()">executePendingTransactions()</a></code> 来直接执行 <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法提交的事务。这样做通常是不必要的，除非事务是其他线程任务的依赖。</p>

<p class="caution"><strong>警告：</strong>你只能在活动组件<a
href="../../guide/components/activities.html#SavingActivityState">保持它的状态</a>（当用户离开活动）前使用  <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> 方法提交事务。如果你在那个点后尝试提交事务，会抛出一个例外。这是因为如果活动组件需要被还原时，事务提交后的状态会丢失。对于可以丢失的事务提交，使用 <code><a href="../../reference/android/app/FragmentTransaction.html#commitAllowingStateLoss()">commitAllowingStateLoss()</a></code> 方法。</p>




<h2 id="CommunicatingWithActivity">与活动组件通信</h2>

<p>尽管<code><a href="../../reference/android/app/Fragment.html">活动碎片</a></code>实现成一个独立于<code><a href="../../reference/android/app/Activity.html">活动</a></code>的对象而且可以在多个活动中使用，一个给定的活动碎片实例被直接绑到包含它的活动组件上。</p>

<p>特别地，活动碎片可以使用 <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> 方法访问<code><a href="../../reference/android/app/Activity.html">活动</a></code>实例，并且能执行像在活动布局中查找视图这种任务：</p>

<pre>
View listView = <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code>.<code><a href="../../reference/android/app/Activity.html#findViewById(int)">findViewById</a></code>(R.id.list);
</pre>

<p>相似地，你的活动组件可以通过 <code><a href="../../reference/android/app/FragmentManager.html">FragmentManager</a></code> 类的 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentById(int)">findFragmentById()</a></code> 或 <code><a href="../../reference/android/app/FragmentManager.html#findFragmentByTag(java.lang.String)">findFragmentByTag()</a></code> 方法获取<code><a href="../../reference/android/app/Fragment.html">活动碎片</a></code>的引用来调用活动碎片中的方法。例如：</p>

<pre>
ExampleFragment fragment = (ExampleFragment) getFragmentManager().findFragmentById(R.id.example_fragment);
</pre>


<h3 id="EventCallbacks">给活动组件创建事件回调</h3>

<p>在一些情况中，你可能需要一个活动碎片同活动组件共享事件。一个不错的方法是在活动碎片中定义回调接口然后在活动宿主中实现它。当活动通过接口收到回调事件，必要时它可以同其它活动碎片共享信息。</p>

<p>例如，如果一个新闻英语在一个活动内有两个活动碎片 — 其中一个显示文章列表（活动碎片 A）另一个显示单个文章（活动碎片 B）— 那么当列表项被选择时活动碎片 A 必须告诉活动组件，这样活动组件可以告诉活动碎片 B 来显示这个文章。在这个例子中，<code>OnArticleSelectedListener</code> 接口在活动碎片 A 中声明：</p>

<pre>
public static class FragmentA extends ListFragment {
    ...
    // Container Activity must implement this interface
    public interface OnArticleSelectedListener {
        public void onArticleSelected(Uri articleUri);
    }
    ...
}
</pre>

<p>然后包含活动碎片的活动组件实现 <code>OnArticleSelectedListener</code> 接口并重载 <code>onArticleSelected()</code> 方法来通知活动碎片 B 来自活动碎片 A 的事件。要确保宿主活动实现这个接口，活动碎片 A 的 <code><a href="../../reference/android/app/Fragment.html#onAttach(android.app.Activity)">onAttach()</a></code> 回调方法（当活动碎片添加到活动组件时系统调用这个方法）将 <code><a href="../../reference/android/app/Fragment.html#onAttach(android.app.Activity)">onAttach()</a></code> 参数传入的<code><a href="../../reference/android/app/Activity.html">活动组件</a></code>转换成 <code>OnArticleSelectedListener</code> 实例：</p>

<pre>
public static class FragmentA extends ListFragment {
    OnArticleSelectedListener mListener;
    ...
    @Override
    public void onAttach(Activity activity) {
        super.onAttach(activity);
        try {
            mListener = (OnArticleSelectedListener) activity;
        } catch (ClassCastException e) {
            throw new ClassCastException(activity.toString() + " must implement OnArticleSelectedListener");
        }
    }
    ...
}
</pre>

<p>如果活动组件没有实现接口，那么活动碎片会抛出一个 <code><a href="../../reference/java/lang/ClassCastException.html">ClassCastException</a></code> 例外。如果成功， <code>mListener</code> 字段会保持一个实现了 <code>OnArticleSelectedListener</code> 接口的活动引用，这样活动碎片 A 可以通过调用 <code>OnArticleSelectedListener</code> 接口中定义的方法同活动组件共享事件。例如，如果活动碎片 A 是 <code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code> 的扩展，每次用户单击列表项，系统调用活动碎片的 <code><a href="../../reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">onListItemClick()</a></code> 方法，该方法再调用 <code>onArticleSelected()</code> 来和活动组件共享这个事件。</p>

<pre>
public static class FragmentA extends ListFragment {
    OnArticleSelectedListener mListener;
    ...
    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        // Append the clicked item's row ID with the content provider Uri
        Uri noteUri = ContentUris.<code><a href="../../reference/android/content/ContentUris.html#withAppendedId(android.net.Uri, long)">withAppendedId</a></code>(ArticleColumns.CONTENT_URI, id);
        // Send the event and Uri to the host activity
        mListener.onArticleSelected(noteUri);
    }
    ...
}
</pre>

<p>传给 <code><a href="../../reference/android/app/ListFragment.html#onListItemClick(android.widget.ListView, android.view.View, int, long)">onListItemClick()</a></code> 方法的 <code>id</code> 参数是被点击项目的行 ID，活动组件（或者其他活动碎片）使用这个 ID 从应用的<code><a href="../../reference/android/content/ContentProvider.html">内容提供器</a></code>中提取文章。</p>

<p><!--To see a complete implementation of this kind of callback interface, see the <a
href="../../resources/samples/NotePad/index.html">NotePad sample</a>. -->更多关于使用内容提供器的信息，查看<a
href="../../guide/topics/providers/content-providers.html">内容提供器</a>文档。</p>



<h3 id="ActionBar">在操作栏中添加项目</h3>

<p>通过实现 <code><a href="../../reference/android/app/Fragment.html#onCreateOptionsMenu(android.view.Menu, android.view.MenuInflater)">onCreateOptionsMenu()</a></code> 方法，你的活动片段可以作为<a
href="../../guide/topics/ui/menus.html#options-menu">菜单选项</a>的条目（即<a
href="../../guide/topics/ui/actionbar.html">操作栏</a>）。你必须在 <code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code> 方法中调用 <code><a href="../../reference/android/app/Fragment.html#setHasOptionsMenu(boolean)">setHasOptionsMenu()</a></code> 方法，表明活动片段想要在菜单选项中添加条目，（否则，活动片段将不会接收 <code><a href="../../reference/android/app/Fragment.html#onCreateOptionsMenu(android.view.Menu, android.view.MenuInflater)">onCreateOptionsMenu()</a></code> 方法的调用）。</p>

<p>任何从活动片段添加到菜单选项的条目都是被附加到已经存在的菜单条目中。当一个菜单条目被选中时，活动片段同时接收到 <code><a href="../../reference/android/app/Fragment.html#onOptionsItemSelected(android.view.MenuItem)">onOptionsItemSelected()</a></code> 方法的回调。</p>

<p>为了提供一个上下文菜单，同样你可以在活动片段布局中注册一个视图，通过调用 <code><a href="../../reference/android/app/Fragment.html#registerForContextMenu(android.view.View)">registerForContextMenu()</a></code> 方法。当用户打开上下文菜单时，活动片段接收到 <code><a href="../../reference/android/app/Fragment.html#onCreateContextMenu(android.view.ContextMenu, android.view.View, android.view.ContextMenu.ContextMenuInfo)">onCreateContextMenu()</a></code>  方法的调用。当用户选择一个条目时，活动片段接收到 <code><a href="../../reference/android/app/Fragment.html#onContextItemSelected(android.view.MenuItem)">onContextItemSelected()</a></code> 方法的调用。</p>

<p class="note"><strong>注意：</strong>尽管添加在活动片段的每个菜单条目接收一个正被选中条目的回调，当用户选择了一个菜单条目，活动片段所在的活动时第一次接收相应的回调。如果活动实现的“正被选中条目”的回调不能处理处理用户所选中的条目，然后这个事件被传递到活动片段的回调中。这也适用于菜单选项和上下文菜单的情况。</p>

<p>更多关于菜单的信息，查看<a
href="../../guide/topics/ui/menus.html">菜单</a>和<a
href="../../guide/topics/ui/actionbar.html">操作栏</a>开发者指南。</p>




<h2 id="Lifecycle">处理活动碎片生命周期</h2>

<div class="figure" style="width:350px">
<img src="../../images/activity_fragment_lifecycle.png" alt=""/>
<p class="img-caption"><strong>图 3.</strong> 活动的生命周期对活动片段生命周期的影响。</p>
</div>

<p>管理活动片段生命周期与管理活动生命周期有点相似。和活动类似，一个活动片段能够在以下三种状态中存在：</p>

<dl>
  <dt><i>恢复状态</i></dt>
    <dd>活动片段在运行的活动中可见。</dd>

  <dt><i>暂停状态</i></dt>
    <dd>其他活动在前台并获的焦点，但是托管了活动片段的活动仍然可见（前台活动是半透明或者并不完全覆盖整个屏幕）。</dd>

  <dt><i>停止状态</i></dt>
    <dd>活动片段不可见。此时要么宿主活动已经停止或活动片段已经从活动中移除并添加到返回栈中。一个被停止的活动片段仍然存活（所有成员的信息和状态依然被系统保留）。然而，它不再可见，如果宿主活动被杀死之后，它也将被杀死。</dd>
</dl>

<p>防止宿主活动的进程被杀死、当一个活动被重新创建时你需要恢复活动片段的状态，与活动一样，你可以使用 <code><a href="../../reference/android/os/Bundle.html">Bundle</a></code> 保留活动片段的状态。你可以在活动片段的 <code><a href="../../reference/android/app/Fragment.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> 回调方法中保存状态并在 <code><a href="../../reference/android/app/Fragment.html#onCreate(android.os.Bundle)">onCreate()</a></code> 方法、 <code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> 方法或者 <code><a href="../../reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">onActivityCreated()</a></code> 方法中恢复活动片段的状态。更多关于保存状态的信息，查看<a
href="../../guide/components/activities.html#SavingActivityState">活动</a>文档。</p>

<p>在活动和活动片段生命周期之间最大的区别是它们如何存储在各自的返回栈中。当一个活动为停止态时，默认它被放置在系统管理的活动返回栈中（用户点击<em>返回</em>按钮之后能够返回到这个活动，在<a
href="../../guide/components/tasks-and-back-stack.html">任务和返回堆栈</a>文档中讨论）。然而，在移除活动片段事务期间，通过调用 <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> 方法显式请求保存的实例时，活动片段将被放置在一个由宿主活动管理的返回栈中。</p>

<p>其它方面，管理活动片段生命周期与管理活动生命周期非常相似。因此，<a
href="../../guide/components/activities.html#Lifecycle">管理活动周期</a>的方法也适用于活动碎片。同时你需要明白的是，活动片段的生命周期受到宿主活动怎样的影响。</p>

<p class="caution"><strong>注意：</strong>如果你在<code><a href="../../reference/android/app/Fragment.html">活动碎片</a></code>中需要一个<code><a href="../../reference/android/content/Context.html">上下文</a></code>对象，你可以调用 <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> 方法。但是，要注意只有在活动碎片连接到活动上时调用 <code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> 方法。当活动片段还没连接到一个活动上或者在生命周期结束时脱离宿主活动，<code><a href="../../reference/android/app/Fragment.html#getActivity()">getActivity()</a></code> 方法会返回 null。</p>


<h3 id="CoordinatingWithActivity">与活动生命周期协调</h3>

<p>包含活动碎片活动的生命周期直接影响该活动碎片的生命周期，每一个活动组件的生命周期回调方法都有产生一个类似的相对应的活动碎片回调方法。例如，当活动收到 <code><a href="../../reference/android/app/Activity.html#onPause()">onPause()</a></code> 回调，活动组件内的每一个活动碎片都收到 <code><a href="../../reference/android/app/Fragment.html#onPause()">onPause()</a></code> 回调。</p>

<p>活动碎片有一些额外的生命周期回调方法，这些回调处理与活动组件的交互来执行像构建和销毁活动碎片用户界面这些操作。这些额外的回调方法有：</p>

<dl>
  <dt><code><a href="../../reference/android/app/Fragment.html#onAttach(android.app.Activity)">onAttach()</a></code></dt>
    <dd>当活动碎片被关联到活动组件时被调用（<code><a href="../../reference/android/app/Activity.html">活动组件</a></code>在这里传入）。</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code></dt>
    <dd>创建与活动碎片关联的视图层级时调用。</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">onActivityCreated()</a></code></dt>
    <dd>当活动的 <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> 方法返回时调用。</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onDestroyView()">onDestroyView()</a></code></dt>
    <dd>当与活动碎片关联的视图层级被移除时调用。</dd>
  <dt><code><a href="../../reference/android/app/Fragment.html#onDetach()">onDetach()</a></code></dt>
    <dd>当活动碎片和活动组件去关联时调用。</dd>
</dl>

<p>活动碎片生命周期的流程以及他们如何被宿主活动组件影响，在图 3. 中演示。在这个图例中，你可以看到每一个活动组件的后继状态如何决定哪一个活动碎片的回调方法会收到信号。例如，当活动组件收到 <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> 回调，该活动组件中的活动碎片只会收到 <code><a href="../../reference/android/app/Fragment.html#onActivityCreated(android.os.Bundle)">onActivityCreated()</a></code> 回调。</p>

<p>一旦活动组件到达恢复状态，你可以随意添加或移除活动碎片到该活动中。也只有在活动处于恢复状态，活动碎片的生命周期可以独立的改变。</p>

<p>但是，当活动组件离开恢复状态，活动碎片再次被活动组件推动生命周期变化。</p>




<h2 id="Example">例子</h2>

<p>要将本文档所有讨论的内容结合在一起，下面是一个使用两个活动碎片来创建双面板布局的活动组件的例子。该活动组件包括一个活动碎片来显示一个莎士比亚剧标题的列表和一个当选择列表项目时显示戏剧摘要信息的活动碎片。这个例子同时展示了如何基于屏幕配置提供不同活动碎片配置的方法。</p>

<p class="note"><strong>注意：</strong>活动的完整的源代码在 <a
href="../../resources/samples/ApiDemos/src/com/example/android/apis/app/FragmentLayout.html"><code>FragmentLayout.java</code></a> 文件提供。</p>

<p>主活动在 <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> 方法中用通常的方法应用一个布局：</p>

<pre>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    setContentView(R.layout.fragment_layout);
}</pre>

<p>被应用的布局文件为 <code>fragment_layout.xml</code>：</p>

<pre>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent" android:layout_height="match_parent"&gt;

    &lt;fragment class="com.example.android.apis.app.FragmentLayout$TitlesFragment"
            android:id="@+id/titles" android:layout_weight="1"
            android:layout_width="0px" android:layout_height="match_parent" /&gt;

    &lt;FrameLayout android:id="@+id/details" android:layout_weight="1"
            android:layout_width="0px" android:layout_height="match_parent"
            android:background="?android:attr/detailsElementBackground" /&gt;

&lt;/LinearLayout&gt;</pre>

<p>使用这个布局，系统在活动组件加载布局文件时将 <code>TitlesFragment</code> 实例化（它列表显示剧目标题）而占用屏幕右边空间的 <code><a href="../../reference/android/widget/FrameLayout.html">FrameLayout</a></code>（显示剧目摘要信息的部分）会一开始显示为空白。正如你在下面会看到的，当用户在列表上选择剧目后，活动碎片才会添加到 <code><a href="../../reference/android/widget/FrameLayout.html">FrameLayout</a></code> 中。</p>

<p>但不是所有的屏幕配置都足够宽来并排显示剧目列表和剧目摘要。所以上面的布局只有在横向屏幕配置时使用，它保存在 <code>res/layout-land/fragment_layout.xml</code> 中。</p>

<p>所以当屏幕时竖直方向时，系统应用下面的布局文件，它保存为 <code>res/layout/fragment_layout.xml</code>：</p>

<pre>&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent" android:layout_height="match_parent"&gt;
    &lt;fragment class="com.example.android.apis.app.FragmentLayout$TitlesFragment"
            android:id="@+id/titles"
            android:layout_width="match_parent" android:layout_height="match_parent" /&gt;
&lt;/FrameLayout&gt;</pre>

<p>This layout includes only <code>TitlesFragment</code>. This means that, when the device is in
portrait orientation, only the list of play titles is visible. So, when the user clicks a list
item in this configuration, the application will start a new activity to show the summary,
instead of loading a second fragment.</p>

<p>Next, you can see how this is accomplished in the fragment classes. First is <code>TitlesFragment</code>, which shows the list of Shakespeare play titles. This fragment extends <code><a href="../../reference/android/app/ListFragment.html">ListFragment</a></code> and relies on it to handle most of the list view work.</p>

<p>As you inspect this code, notice that there are two possible behaviors when the user clicks a
list item: depending on which of the two layouts is active, it can either create and display a new
fragment to show the details in the same activity (adding the fragment to the <code><a href="../../reference/android/widget/FrameLayout.html">FrameLayout</a></code>), or start a new activity (where the fragment can be shown).</p>

<pre>public static class TitlesFragment extends ListFragment {
    boolean mDualPane;
    int mCurCheckPosition = 0;

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
        super.onActivityCreated(savedInstanceState);

        // Populate list with our static array of titles.
        setListAdapter(new ArrayAdapter&lt;String&gt;(getActivity(),
                android.R.layout.simple_list_item_activated_1, Shakespeare.TITLES));

        // Check to see if we have a frame in which to embed the details
        // fragment directly in the containing UI.
        View detailsFrame = getActivity().findViewById(R.id.details);
        mDualPane = detailsFrame != null &amp;&amp; detailsFrame.getVisibility() == View.VISIBLE;

        if (savedInstanceState != null) {
            // Restore last state for checked position.
            mCurCheckPosition = savedInstanceState.getInt("curChoice", 0);
        }

        if (mDualPane) {
            // In dual-pane mode, the list view highlights the selected item.
            getListView().setChoiceMode(ListView.CHOICE_MODE_SINGLE);
            // Make sure our UI is in the correct state.
            showDetails(mCurCheckPosition);
        }
    }

    @Override
    public void onSaveInstanceState(Bundle outState) {
        super.onSaveInstanceState(outState);
        outState.putInt("curChoice", mCurCheckPosition);
    }

    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        showDetails(position);
    }

    /**
     * Helper function to show the details of a selected item, either by
     * displaying a fragment in-place in the current UI, or starting a
     * whole new activity in which it is displayed.
     */
    void showDetails(int index) {
        mCurCheckPosition = index;

        if (mDualPane) {
            // We can display everything in-place with fragments, so update
            // the list to highlight the selected item and show the data.
            getListView().setItemChecked(index, true);

            // Check what fragment is currently shown, replace if needed.
            DetailsFragment details = (DetailsFragment)
                    getFragmentManager().findFragmentById(R.id.details);
            if (details == null || details.getShownIndex() != index) {
                // Make new fragment to show this selection.
                details = DetailsFragment.newInstance(index);

                // Execute a transaction, replacing any existing fragment
                // with this one inside the frame.
                FragmentTransaction ft = getFragmentManager().beginTransaction();
                if (index == 0) {
                    ft.replace(R.id.details, details);
                } else {
                    ft.replace(R.id.a_item, details);
                }
                ft.setTransition(FragmentTransaction.TRANSIT_FRAGMENT_FADE);
                ft.commit();
            }

        } else {
            // Otherwise we need to launch a new activity to display
            // the dialog fragment with selected text.
            Intent intent = new Intent();
            intent.setClass(getActivity(), DetailsActivity.class);
            intent.putExtra("index", index);
            startActivity(intent);
        }
    }
}</pre>

<p>The second fragment, <code>DetailsFragment</code> shows the play summary for the item selected from
the list from <code>TitlesFragment</code>:</p>
 
<pre>public static class DetailsFragment extends Fragment {
    /**
     * Create a new instance of DetailsFragment, initialized to
     * show the text at 'index'.
     */
    public static DetailsFragment newInstance(int index) {
        DetailsFragment f = new DetailsFragment();

        // Supply index input as an argument.
        Bundle args = new Bundle();
        args.putInt("index", index);
        f.setArguments(args);

        return f;
    }

    public int getShownIndex() {
        return getArguments().getInt("index", 0);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState) {
        if (container == null) {
            // We have different layouts, and in one of them this
            // fragment's containing frame doesn't exist.  The fragment
            // may still be created from its saved state, but there is
            // no reason to try to create its view hierarchy because it
            // won't be displayed.  Note this is not needed -- we could
            // just run the code below, where we would create and return
            // the view hierarchy; it would just never be used.
            return null;
        }

        ScrollView scroller = new ScrollView(getActivity());
        TextView text = new TextView(getActivity());
        int padding = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,
                4, getActivity().getResources().getDisplayMetrics());
        text.setPadding(padding, padding, padding, padding);
        scroller.addView(text);
        text.setText(Shakespeare.DIALOGUE[getShownIndex()]);
        return scroller;
    }
}</pre>

<p>Recall from the <code>TitlesFragment</code> class, that, if the user clicks a list item and the
current layout does <em>not</em> include the <code>R.id.details</code> view (which is where the
<code>DetailsFragment</code> belongs), then the application starts the <code>DetailsActivity</code>
activity to display the content of the item.</p>

<p>Here is the <code>DetailsActivity</code>, which simply embeds the <code>DetailsFragment</code> to display
the selected play summary when the screen is in portrait orientation:</p>

<pre>public static class DetailsActivity extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        if (getResources().getConfiguration().orientation
                == Configuration.ORIENTATION_LANDSCAPE) {
            // If the screen is now in landscape mode, we can show the
            // dialog in-line with the list so we don't need this activity.
            finish();
            return;
        }

        if (savedInstanceState == null) {
            // During initial setup, plug in the details fragment.
            DetailsFragment details = new DetailsFragment();
            details.setArguments(getIntent().getExtras());
            getFragmentManager().beginTransaction().add(android.R.id.content, details).commit();
        }
    }
}</pre>
 
<p>Notice that this activity finishes itself if the configuration is landscape, so that the main
activity can take over and display the <code>DetailsFragment</code> alongside the <code>TitlesFragment</code>.
This can happen if the user begins the <code>DetailsActivity</code> while in portrait orientation, but
then rotates to landscape (which restarts the current activity).</p>


<p>For more samples using fragments (and complete source files for this example),
see the API Demos sample app available in <a
href="../../resources/samples/ApiDemos/src/com/example/android/apis/app/index.html#Fragment">
ApiDemos</a> (available for download from the <a
href="../../resources/samples/get.html">Samples SDK component</a>).</p>



    </div>
      
      <div class="content-footer layout-content-row" 
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-8" style="padding-top:4px">
          
            <div class="g-plusone" data-size="medium"></div>
          
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
      

  </div><!-- end jd-content --> 

<div id="footer" class="wrap" >
        

  <div id="copyright">
    
  
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="../../about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../support.html">Support</a>
  </p>
  </div>

</div><!-- end footer --> 
</div><!-- end doc-content -->

</div><!-- end body-content -->  






</body>
</html>



