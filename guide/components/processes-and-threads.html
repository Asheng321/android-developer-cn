<!DOCTYPE html>












































































<html>
<head>


<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width" />

<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>进程和线程 | 安卓开发者</title><!-- STYLESHEETS --><!-- JAVASCRIPT -->


<link rel="stylesheet"
href="http://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">




<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var devsite = false;
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5831155-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="gc-documentation 
  develop guide" itemscope itemtype="http://schema.org/Article"><!-- Header -->

<a name="top"></a>

    
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 logo">
          <a href="../../index.html">
            <img src="../../assets/images/dac_logo.png" width="123" height="25" alt="Android Developers" />
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
          	<a href="#" class="arrow-inactive">Quicknav</a>
			      <a href="#" class="arrow-active">Quicknav</a>
          </div>
          </div>
            <ul class="nav-x col-9">
                <li class="design">
                  <a href="../../design/index.html"
                  zh-tw-lang="設計"
                  zh-cn-lang="设计"
                  ru-lang="Проектирование"
                  ko-lang="디자인"
                  ja-lang="設計"
                  es-lang="Diseñar"               
                  >设计</a></li>
                <li class="develop"><a href="../../develop/index.html"
                  zh-tw-lang="開發"
                  zh-cn-lang="开发"
                  ru-lang="Разработка"
                  ko-lang="개발"
                  ja-lang="開発"
                  es-lang="Desarrollar"               
                  >开发</a></li>
                <li class="distribute last"><a href="../../distribute/index.html"
                  zh-tw-lang="發佈"
                  zh-cn-lang="分发"
                  ru-lang="Распространение"
                  ko-lang="배포"
                  ja-lang="配布"
                  es-lang="Distribuir"               
                  >分发</a></li>
            </ul><!-- New Search -->
            
            
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="../../about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com">Android Open Source Project</a></li>
      </ul>
      
      
      
      


      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>
  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '../../')" 
onkeyup="return search_changed(event, false, '../../')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  </div><!-- /New Search>
          
          
          <!-- Expanded quicknav -->
  
           <div id="quicknav" class="col-9">
                <ul>
                    <li class="design">
                      <ul>
                        <li><a href="../../design/index.html">入门</a></li>
                        <li><a href="../../design/style/index.html">样式</a></li>
                        <li><a href="../../design/patterns/index.html">设计模式</a></li>
                        <li><a href="../../design/building-blocks/index.html">构造块</a></li>
                        <li><a href="../../design/downloads/index.html">下载</a></li>
                        <li><a href="../../design/videos/index.html">视频</a></li>
                      </ul>
                    </li>
                    <li class="develop">
                      <ul>
                        <li><a href="../../training/index.html"
                          zh-tw-lang="訓練課程"
                          zh-cn-lang="培训"
                          ru-lang="Курсы"
                          ko-lang="교육"
                          ja-lang="トレーニング"
                          es-lang="Capacitación"               
                          >训练课程</a></li>
                        <li><a href="../../guide/components/index.html"
                          zh-tw-lang="API 指南"
                          zh-cn-lang="API 指南"
                          ru-lang="Руководства по API"
                          ko-lang="API 가이드"
                          ja-lang="API ガイド"
                          es-lang="Guías de la API"               
                          >API 指南</a></li>
                        <li><a href="../../reference/packages.html"
                          zh-tw-lang="參考資源"
                          zh-cn-lang="参考"
                          ru-lang="Справочник"
                          ko-lang="참조문서"
                          ja-lang="リファレンス"
                          es-lang="Referencia"               
                          >参考资源</a></li>
                        <li><a href="../../tools/index.html"
                          zh-tw-lang="相關工具"
                          zh-cn-lang="工具"
                          ru-lang="Инструменты"
                          ko-lang="도구"
                          ja-lang="ツール"
                          es-lang="Herramientas"               
                          >开发工具</a>
                          <ul><li><a href="../../sdk/index.html">获取 SDK</a></li></ul>
                        </li>
                        <li><a href="../../google/index.html">Google 服务</a>
                        </li>
                        
                      </ul>
                    </li>
                    <li class="distribute last">
                      <ul>
                        <li><a href="../../distribute/index.html">Google Play 市场</a></li>
                        <li><a href="../../distribute/googleplay/publish/index.html">应用发布</a></li>
                        <li><a href="../../distribute/googleplay/promote/index.html">应用推广</a></li>
                        <li><a href="../../distribute/googleplay/quality/index.html">应用质量</a></li>
                        <li><a href="../../distribute/googleplay/spotlight/index.html">精品聚焦</a></li>
                        <li><a href="../../distribute/open.html">开放发行</a></li>
                      </ul>
                    </li>
                </ul>
          </div><!-- /Expanded quicknav -->
          
        </div>
    </div><!-- /Header -->
    
    
    
  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div><!-- Secondary x-nav -->
    
    
  
    
    <div id="nav-x">
        <div class="wrap">
            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"               
                  >训练课程</a></li>
                <li class="guide"><a href="../../guide/components/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"               
                  >API 指南</a></li>
                <li class="reference"><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"               
                  >参考资源</a></li>
                <li class="tools"><a href="../../tools/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >开发工具</a></li>
                <li class="google"><a href="../../google/index.html"
                  >Google 服务</a>
                </li>
                
            </ul>
        </div>
        
    </div><!-- /Sendondary x-nav -->
    
  




  

  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="#top" data-g-event="left-nav-top">to top</a>



<ul id="nav"><!--  Walkthrough for Developers -- quick overview of what it's like to develop on Android --><!--<li style="color:red">Overview</li> -->
  
  

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/components/index.html">
        <span class="en">应用组件</span>
      </a></div>
    <ul>
      <li><a href="../../guide/components/fundamentals.html">
            <span class="en">应用基本知识</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/activities.html">
            <span class="en">活动</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/fragments.html">
              <span class="en">活动片段</span>
            </a></li>
          <li><a href="../../guide/components/loaders.html">
              <span class="en">加载器</span>
            </a></li>
          <li><a href="../../guide/components/tasks-and-back-stack.html">
              <span class="en">任务和活动堆栈</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/services.html">
            <span class="en">服务</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/bound-services.html">
              <span class="en">绑定服务</span>
            </a></li>
          <li><a href="../../guide/components/aidl.html">
              <span class="en">AIDL</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/providers/content-providers.html">
            <span class="en">内容提供商</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/providers/content-provider-basics.html">
              <span class="en">内容提供商基础</span>
            </a></li>
          <li><a href="../../guide/topics/providers/content-provider-creating.html">
              <span class="en">创建一个内容提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/calendar-provider.html">
              <span class="en">日历提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/contacts-provider.html">
              <span class="en">联系人提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/document-provider.html">
              <span class="en">存储访问框架</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/components/intents-filters.html">
          <span class="en">意图与意图过滤器</span>
        </a></li>
      <li><a href="../../guide/components/processes-and-threads.html">
          <span class="en">进程和线程</span>
        </a>
      </li>
      <li><a href="../../guide/topics/security/permissions.html">
          <span class="en">权限</span>
        </a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/appwidgets/index.html">
            <span class="en">应用小部件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/appwidgets/host.html">
              <span class="en">应用小部件托管</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/manifest/manifest-intro.html">
          <span class="en">安卓项目清单</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/manifest/action-element.html">&lt;action&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-alias-element.html">&lt;activity-alias&gt;</a></li>
          <li><a href="../../guide/topics/manifest/application-element.html">&lt;application&gt;</a></li>
          <li><a href="../../guide/topics/manifest/category-element.html">&lt;category&gt;</a></li>
          <li><a href="../../guide/topics/manifest/compatible-screens-element.html">&lt;compatible-screens&gt;</a></li>
          <li><a href="../../guide/topics/manifest/data-element.html">&lt;data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/grant-uri-permission-element.html">&lt;grant-uri-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/instrumentation-element.html">&lt;instrumentation&gt;</a></li>
          <li><a href="../../guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></li>
          <li><a href="../../guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></li>
          <li><a href="../../guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/path-permission-element.html">&lt;path-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-element.html">&lt;permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-group-element.html">&lt;permission-group&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-tree-element.html">&lt;permission-tree&gt;</a></li>
          <li><a href="../../guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></li>
          <li><a href="../../guide/topics/manifest/receiver-element.html">&lt;receiver&gt;</a></li>
          <li><a href="../../guide/topics/manifest/service-element.html">&lt;service&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-gl-texture-element.html">&lt;supports-gl-texture&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-screens-element.html">&lt;supports-screens&gt;</a></li><!-- ##api level 4## -->
          <li><a href="../../guide/topics/manifest/uses-configuration-element.html">&lt;uses-configuration&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></li><!-- ##api level 4## --> 
          <li><a href="../../guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-permission-element.html">&lt;uses-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></li>
        </ul>
   </li><!-- end of the manifest file -->

    </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/topics/ui/index.html">
        <span class="en">用户界面</span>
      </a></div>
    <ul>
      <li><a href="../../guide/topics/ui/overview.html">
          <span class="en">概述</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/declaring-layout.html">
            <span class="en">布局</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/layout/linear.html">
              <span class="en">线性布局</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/relative.html">
              <span class="en">相对布局</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/layout/grid.html">
              <span class="en">Grid Layout</span>
            </a></li>
       -->
       
          <li><a href="../../guide/topics/ui/layout/listview.html">
              <span class="en">列表视图</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/gridview.html">
              <span class="en">网格视图</span>
            </a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/controls.html">
            <span class="en">输入控件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/controls/button.html">
              <span class="en">按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/text.html">
              <span class="en">文本框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/checkbox.html">
              <span class="en">复选框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/radiobutton.html">
              <span class="en">单选按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/togglebutton.html">
              <span class="en">切换按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/spinner.html">
              <span class="en">下拉列表</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/pickers.html">
              <span class="en">选择器</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/controls/progress.html">
              <span class="en">Seek and Progress Bars</span>
            </a></li>
-->

        </ul>
      </li>
      <li><a href="../../guide/topics/ui/ui-events.html">
          <span class="en">输入事件</span>
        </a></li>
      <li><a href="../../guide/topics/ui/menus.html">
          <span class="en">菜单</span></span>
          </a></li>
      <li><a href="../../guide/topics/ui/actionbar.html">
           <span class="en">操作栏</span>
          </a></li>
      <li><a href="../../guide/topics/ui/settings.html">
            <span class="en">设置</span>
          </a></li>
      <li><a href="../../guide/topics/ui/dialogs.html">
           <span class="en">对话框</span>
          </a></li>
      <li><a href="../../guide/topics/ui/notifiers/notifications.html">
          <span class="en">通知</span>
        </a></li>
      <li><a href="../../guide/topics/ui/notifiers/toasts.html">
          <span class="en">提醒框</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/search/index.html">
            <span class="en">搜索</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/search/search-dialog.html">创建一个搜索界面</a></li>
            <li><a href="../../guide/topics/search/adding-recent-query-suggestions.html">添加最近查询建议</a></li>
            <li><a href="../../guide/topics/search/adding-custom-suggestions.html">添加自定义建议</a></li>
            <li><a href="../../guide/topics/search/searchable-config.html">可搜索配置</a></li>
          </ul>
      </li>
      <li><a href="../../guide/topics/ui/drag-drop.html">
          <span class="en">拖放</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/accessibility/index.html">
            <span class="en">辅助功能</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/accessibility/apps.html">
              <span class="en">让应用可访问</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/checklist.html">
              <span class="en">辅助功能开发者清单</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/services.html">
              <span class="en">构建辅助功能服务</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/ui/themes.html">
          <span class="en">样式与主题</span>
        </a></li>
      <li><a href="../../guide/topics/ui/custom-components.html">
          <span class="en">自定义组件</span>
        </a></li>
    </ul>
  </li><!-- end of User Interface -->

    <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/resources/index.html">
           <span class="en">应用资源</span>
         </a></div>
      <ul>
        <li><a href="../../guide/topics/resources/overview.html">
            <span class="en">概述</span>
          </a></li>
          <li><a href="../../guide/topics/resources/providing-resources.html">
            <span class="en">提供资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/accessing-resources.html">
            <span class="en">访问资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/runtime-changes.html">
              <span class="en">处理运行时更改</span>
            </a></li>
        <li><a href="../../guide/topics/resources/localization.html">
            <span class="en">本地化</span>
          </a></li>
        <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/resources/available-resources.html">
              <span class="en">资源类型</span>
            </a></div>
          <ul>
            <li><a href="../../guide/topics/resources/animation-resource.html">动画</a></li>
            <li><a href="../../guide/topics/resources/color-list-resource.html">颜色状态列表</a></li>
            <li><a href="../../guide/topics/resources/drawable-resource.html">可描绘资源</a></li>
            <li><a href="../../guide/topics/resources/layout-resource.html">布局</a></li>
            <li><a href="../../guide/topics/resources/menu-resource.html">菜单</a></li>
            <li><a href="../../guide/topics/resources/string-resource.html">字符串</a></li>
            <li><a href="../../guide/topics/resources/style-resource.html">样式</a></li>
            <li><a href="../../guide/topics/resources/more-resources.html">更多类型</a></li>
          </ul>
        </li><!-- end of resource types -->
      </ul>
    </li><!-- end of app resources -->

   <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/graphics/index.html">
          <span class="en">动画与图形</span>
        </a></div>
      <ul>
      <li class="nav-section">
        </li><li><a href="../../guide/topics/graphics/overview.html">
            <span class="en">概述</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/prop-animation.html">
            <span class="en">属性动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/view-animation.html">
            <span class="en">补间动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/drawable-animation.html">
            <span class="en">帧动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/2d-graphics.html">
            <span class="en">画布与图形</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/opengl.html">
            <span class="en">OpenGL ES</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/hardware-accel.html">
            <span class="en">硬件加速</span>
          </a></li>
       </ul>
    </li><!-- end of graphics and animation-->

   <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/topics/renderscript/index.html">
              <span class="en">计算</span>
            </a></div>
            <ul>
              <li><a href="../../guide/topics/renderscript/compute.html">
                    <span class="en">RenderScript</span></a>
                  </li>

              <li><a href="../../guide/topics/renderscript/advanced.html">
                    <span class="en">RenderScript 进阶</span></a>
                  </li>
              <li><a href="../../guide/topics/renderscript/reference.html">
                    <span class="en">运行时 API 参考</span></a>
              </li>
             </ul>
   </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/media/index.html">
            <span class="en">多媒体与照相机</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/media/mediaplayer.html">
                  <span class="en">多媒体播放</span></a>
                </li>
            <li><a href="../../guide/appendix/media-formats.html">
                   <span class="en">支持的多媒体格式</span></a>
                </li>
            <li><a href="../../guide/topics/media/audio-capture.html">
                  <span class="en">音频录制</span></a>
                </li>
            <li><a href="../../guide/topics/media/jetplayer.html">
                  <span class="en">JetPlayer</span></a>
                </li>
            <li><a href="../../guide/topics/media/camera.html">
                  <span class="en">照相机</span></a>
                </li>
          </ul>
      </li><!-- end of media and camera -->

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/sensors/index.html">
              <span class="en">位置与传感器</span>
              </a></div>
        <ul>
          <li><a href="../../guide/topics/location/index.html">
               <span class="en">位置和地图</span>
             </a>
          </li><li><a href="../../guide/topics/location/strategies.html">
               <span class="en">位置策略</span>
             </a></li>
          <li><a href="../../guide/topics/sensors/sensors_overview.html">
              <span class="en">传感器概述</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_motion.html">
              <span class="en">动作传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_position.html">
              <span class="en">位置传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_environment.html">
              <span class="en">环境传感器</span>
            </a></li>
        </ul>
      </li><!-- end of location and sensors -->



<li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/index.html">
               <span class="en">连接性</span>
             </a></div>
        <ul>
          <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/bluetooth.html">
          <span class="en">蓝牙</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/bluetooth-le.html">低功耗蓝牙</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/nfc/index.html">
          <span class="en">NFC</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/nfc/nfc.html">NFC 基础</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/advanced-nfc.html">高级 NFC</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/hce.html">Host-based Card Emulation</a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/connectivity/wifip2p.html">
            <span class="en">Wi-Fi P2P</span></a>
          </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/connectivity/usb/index.html">
            <span class="en">USB</span></a>
          </div>
            <ul>
              <li><a href="../../guide/topics/connectivity/usb/accessory.html">附件</a></li>
              <li><a href="../../guide/topics/connectivity/usb/host.html">主机</a></li>
            </ul>
     </li>
     <li><a href="../../guide/topics/connectivity/sip.html">
            <span class="en">SIP</span>
          </a>
     </li>

    </ul>
  </li><!-- end of connectivity -->


      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/text/index.html">
            <span class="en">文本与输入</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/text/copy-paste.html">
              <span class="en">复制和粘贴</span>
            </a></li>
          <li><a href="../../guide/topics/text/creating-input-method.html">
              <span class="en">创建输入法引擎</span>
            </a></li>
          <li><a href="../../guide/topics/text/spell-checker-framework.html">
              <span class="en">拼写检查</span>
            </a></li>
        </ul>
      </li><!-- end of text and input -->

     <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/data/index.html">
          <span class="en">数据存储</span>
        </a></div>
      <ul>
         <li><a href="../../guide/topics/data/data-storage.html">
            <span class="en">存储选项</span>
           </a></li>
        <li><a href="../../guide/topics/data/backup.html">
            <span class="en">数据备份</span>
          </a></li>
        <li><a href="../../guide/topics/data/install-location.html">
            <span class="en">应用安装位置</span>
          </a></li>
      </ul>
    </li><!-- end of data storage -->


  <li class="nav-section">
           <div class="nav-section-header"><a href="../../guide/topics/admin/index.html">
               <span class="en">管理</span>
             </a></div>
           <ul>
              <li>
                <a href="../../guide/topics/admin/device-admin.html">
                <span class="en">设备管理</span></a>
              </li><!--
              <li>
                <a href="../../guide/topics/admin/keychain.html">
                <span class="en">Certificate Store</span></a>
              </li>
            -->
            
           </ul>
  </li><!-- end of administration -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/webapps/index.html">
    <span class="en">Web 应用</span>
    </a></div>
    <ul>
      <li><a href="../../guide/webapps/overview.html">
            <span class="en">概述</span>
          </a></li>
      <li><a href="../../guide/webapps/targeting.html">
            <span class="en">Web 应用的目标屏幕</span>
          </a></li>
      <li><a href="../../guide/webapps/webview.html">
            <span class="en">在 WebView 中创建 Web 应用</span>
          </a></li>
      <li><a href="../../guide/webapps/migrating.html">
            <span class="en">迁移到 Android 4.4 版本的 WebView</span>
          </a></li>
      <li><a href="../../guide/webapps/debugging.html">
            <span class="en">Web 应用调试</span>
          </a></li>
      <li><a href="../../guide/webapps/best-practices.html">
            <span class="en">Web 应用的最佳实践</span>
          </a></li>
    </ul>
  </li><!-- end of web apps -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/practices/index.html">
      <span class="en">最佳实践</span> <span class="de" style="display:none">Bewährte Verfahren</span> <span class="es" style="display:none">Prácticas recomendadas</span> <span class="fr" style="display:none">Meilleures pratiques</span> <span class="it" style="display:none">Best practice</span> <span class="ja" style="display:none">ベスト プラクティス</span> <span class="zh-cn" style="display:none">最佳实践</span> <span class="zh-tw" style="display:none">最佳實務</span>
    </a></div></a>
    <ul>
      <li><a href="../../guide/practices/compatibility.html">
            <span class="en">兼容性</span>
          </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/screens_support.html">
          <span class="en">支持多个屏幕</span>
        </a></div>
        <ul>
          <li><a href="../../guide/practices/screens-distribution.html">
            <span class="en">分发给特定的屏幕</span>
          </a></li>
          <li><a href="../../guide/practices/screen-compat-mode.html">
            <span class="en">屏幕兼容性模式</span>
          </a></li>
        </ul>
      </li>
      <li><a href="../../guide/practices/tablets-and-handsets.html">
            <span class="en">支持平板设备和手持设备</span>
          </a></li>

    </ul>
  </li><!-- this needs to move
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/index.html">
               <span class="en">UI Guidelines</span>
             </a></div>
        <ul>
          <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/icon_design.html">
                   <span class="en">Icon Design</span>
                 </a></div>
            <ul>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_launcher.html">
                    <span class="en">Launcher Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_menu.html">
                    <span class="en">Menu Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_action_bar.html">
                    <span class="en">Action Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_status_bar.html">
                    <span class="en">Status Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_tab.html">
                    <span class="en">Tab Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_dialog.html">
                    <span class="en">Dialog Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_list.html">
                    <span class="en">List View Icons</span>
                  </a></li>
            </ul>
          </li>
          <li><div><a href="../../guide/practices/ui_guidelines/widget_design.html">
                <span class="en">App Widget Design</span>
              </a></div>
          </li>
        </ul>
      </li>
        </ul> --><!-- Remove
  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/appendix/index.html">
        <span class="en">Appendix</span>
        <span class="de" style="display:none">Anhang</span>
        <span class="es" style="display:none">Apéndice</span>
        <span class="fr" style="display:none">Annexes</span>
        <span class="it" style="display:none">Appendice</span>
        <span class="ja" style="display:none">付録</span>
        <span class="zh-cn" style="display:none">附录</span>
        <span class="zh-tw" style="display:none">附錄</span>
      </a></div>
    <ul>
      <li><a href="../../guide/appendix/g-app-intents.html">
            <span class="en">Intents List: Google Apps</span>
          </a></li>


      <li><a href="../../guide/appendix/glossary.html">
            <span class="en">Glossary</span>
          </a></li>
    </ul>
  </li>

</li>
-->

      


</ul>


<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>


        

      </div>
    </div><!-- end side-nav --> 
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >进程和线程</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
<div id="qv">
<h2>要点</h2>
<ul>
  <li>每一个应用都运行在自己的进程中，默认应用中所有的组件也都运行在这个进程里。</li>
  <li>活动中任何缓慢的、阻塞的操作都应该在新线程中执行，以避免减慢用户界面的运行。</li>
</ul>

<h2>在本文档中</h2>
<ol>
<li><a href="#Processes">进程</a>
  <ol>
    <li><a href="#Lifecycle">进程生命周期</a></li>
  </ol>
</li>
<li><a href="#Threads">线程</a>
  <ol>
    <li><a href="#WorkerThreads">工作线程</a></li>
    <li><a href="#ThreadSafe">线程安全方法</a></li>
  </ol>
</li>
<li><a href="#IPC">进程间通信</a></li>
</ol>

</div>
</div>

<p>当一个应用程序在没有其他组件在运行的时候启动，安卓系统会启动为其一个新的单线程 Linux 进程来执行。默认情况下，同一个应用程序的所有组件运行在同一个进程和线程（主线程）中。如果当一个应用程序组件启动的时候，系统中已经存在该应用的进程（因为应用的其它组件已经在运行了），那么这个组件将会在这个已经存在的进程中启动并使用同一个线程来执行。但是，你也可以将你的应用中的不同组件安排在不同的进程中执行，同时你也可以为任意一个进程创建多个附加的线程。</p>

<p>本文档将讨论进程和线程如何在安卓应用中工作。</p>


<h2 id="Processes">进程</h2>

<p>一般来说，同一个应用的所有组件都应该在同一个进程中运行，大部分应用程序都应该遵循这个原则。不过，当你发现你需要控制某一个组件属于哪一个进程时，你可以通过修改项目清单文件来实现。</p>

<p>每一类组件元素的清单项 — <a
href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a>，<a href="../../guide/topics/manifest/service-element.html"><code>&lt;service&gt;</code></a>，<a href="../../guide/topics/manifest/receiver-element.html"><code>&lt;receiver&gt;</code></a> 和 <a href="../../guide/topics/manifest/provider-element.html"><code>&lt;provider&gt;</code></a> — 都支持 <code>android:process</code> 属性，这个属性可以指定对应的组件运行在一个特定的进程中。你可以设定这个属性以便让每一个组件都在它们自己的进程中运行，或者也可以让部分组件共享某一个进程但其他的组件不共享。你也可以通过设置 <code>android:process</code> 让不同应用程序的组件运行在同一个进程中 — 让这些应用程序共享同一个 Linux 用户 ID 同时使用同样的证书来签名。</p>

<p><a href="../../guide/topics/manifest/application-element.html"><code>&lt;application&gt;</code></a> 元素同样支持 <code>android:process</code> 属性，它用于设定一个默认的值应用在所以的组件上。</p>

<p>当系统内存过低而且有其他对用户来说更加紧急的进程请求内存的时候，安卓系统将会在某一个时间点杀死一个进程。那些运行在这个被杀死的进程中的应用程序组件将会因此而被销毁。当这些组件再次继续它们之前的操作时，它们对应的进程也会再次启动。</p>

<p>安卓系统将以各个进程对用户的相对重要程度为权重，来决定哪一个进程将被杀死。例如，和一个托管可见活动的进程相比，杀死一个托管不可见活动的进程显然更容易。因此，决定一个进程是否终止取决于这个进程中的组件的运行状态。下面讨论的将是用于决定哪一个进程将被终止的规则。 </p>


<h3 id="Lifecycle">进程生命周期</h3>

<p>安卓系统原则上尽可能长保持一个应用进程，但有时会为一些更为重要的进程删除旧的进程从而释放内存空间。这些“重要性级别”的定义取决于运行在该进程中的组件以及这些组件的状态，而系统根据“重要性级别”来判断那些进程保持，那些进程会被杀死。当系统资源需释放时，理所当然地最低重要性级别的进程应最先被终止，接着被终止的就是重要性级别次于最低级别的进程，以此类推，直到系统资源足够为止。</p>

<p>进程的重要性级别分为五个等级。下面根据重要性列出了不同种类的介绍（第一个进程为“最重要”，也会最后被杀死）：</p>

<ol>
  <li><b>前台进程</b>
    <p>涉及到当前用户正在进行操作的进程为前台进程。如果满足下面所列其中一种情况的进程即为前台进程。</p>

      <ul>
        <li>进程托管一个用户正在交互的<code><a href="../../reference/android/app/Activity.html">活动</a></code>（<code><a href="../../reference/android/app/Activity.html">活动</a></code>的 <code><a href="../../reference/android/app/Activity.html#onResume()">onResume()</a></code> 方法正在被调用）。</li>

        <li>进程托管一个与用户正在交互的活动绑定的<code><a href="../../reference/android/app/Service.html">服务</a></code>。</li>

        <li>进程托管一个正在“前台”运行的<code><a href="../../reference/android/app/Service.html">服务</a></code> — 这个服务调用 <code><a href="../../reference/android/app/Service.html#startForeground(int, android.app.Notification)">startForeground()</a></code>方法。

        </li><li>进程托管一个生命周期回调方法（<code><a href="../../reference/android/app/Service.html#onCreate()">onCreate()</a></code>、<code><a href="../../reference/android/app/Service.html#onStart(android.content.Intent, int)">onStart()</a></code>、<code><a href="../../reference/android/app/Service.html#onDestroy()">onDestroy()</a></code>）正在被执行的 <code><a href="../../reference/android/app/Service.html">服务</a></code>。</li>

        <li>进程托管一个正执行 <code><a href="../../reference/android/content/BroadcastReceiver.html#onReceive(android.content.Context, android.content.Intent)">onReceive()</a></code> 方法的<code><a href="../../reference/android/content/BroadcastReceiver.html">广播接收器</a></code>。</li>
    </ul>

    <p>通常在特定的时间内，只有为数不多的前台进程存在。在内存的剩余资源非常少以至这些前台进程不能继续保持运行的情况下才会被迫不得已杀死。就此而言，当用户的设备达到内存分页的状态时，杀死一些前台进程是为了让用户体验更好，系统能够及时的响应用户的操作。</p></li>

  <li><b>可视进程</b>
    <p>可视进程是一种没有任何前台组件的进程，但是它仍然能影响用户在屏幕上看到东西。只要满足下面所列其中一种情况的进程即为可视进程。</p>

      <ul>
        <li>进程托管一个<code><a href="../../reference/android/app/Activity.html">活动</a></code>，它尽管不在前台但仍能被用户看见（它的 <code><a href="../../reference/android/app/Activity.html#onPause()">onPause()</a></code> 方法被调用）。这是有可能发生的，例如如果一个前台活动开启一个对话框，这个对话框没有完全覆盖该活动。</li>

        <li>进程托管一个绑定到可见（或前台）活动的<code><a href="../../reference/android/app/Service.html">服务</a></code>。</li>
      </ul>

      <p>可视进程十分重要的，除非为了保持所有前台进程运行，可视进程才有可能被杀死。 </p>
    </li>

  <li><b>服务进程</b>
    <p>如果一个进程正运行一个服务，服务已经启动 <code><a href="../../reference/android/content/Context.html#startService(android.content.Intent)">startService()</a></code> 方法，但是这个进程不是前台进程和可视进程，那么这个进程是服务进程。尽管服务进程没有直接绑定在任何用户可见视图，但其处理的操作同样为用户所关心（例如在后台播放音乐、从网络上下载数据），除非系统没有足够的内存空间同时保持前台进程和可见进程同时运行，系统才不会保持这些服务进程运行。 </p>
  </li>

  <li><b>后台进程</b>
    <p>如果进程包含对用户不可见的活动（活动的 <code><a href="../../reference/android/app/Activity.html#onStop()">onStop()</a></code> 方法被调用），这个进程是后台进程。这些后台进程对用户体验没有直接的影响，当系统需要为后台、可视或者服务进程释放内存空间时可随时杀死这些后台进程。通常系统中有大量后台进程在运行，所有正在运行的后台进程都记录在LRU（最近最少使用）表中，以确保带有最近被用户看到的活动的进程最后一个被杀死。如果一个活动正确地实现了声明周期方法，和保存了当前状态，杀死这个活动所在的进程对用户的视觉改变是不会被感受到的，理由在于当用户导航返回该活动时会恢复所有可见的状态。查看<a
href="../../guide/components/activities.html#SavingActivityState">活动</a>文档来了解更多关于保存和恢复活动状态的更多信息。</p>
  </li>

  <li><b>空进程</b>
    <p>不包含任何一个活跃状态的应用程序组件的进程为空进程。唯一保持这种进程活跃的目的是为了缓存，以此优化了下次当有一个必要的组件需要运行在该空进程时的启动时间。为了平衡进程缓存和底层内核缓存之间的整体系统资源，安卓系统经常把空进程杀死。</p>
  </li>
</ol>


  <p>安卓系统根据进程中当前活动组件的重要性，设置进程的最高优先级。举例来说，如果一个进程托管一个服务组件和一个可见的活动组件，那么这个进程会被设置为可视线程级别，而不是服务进程级别。</p>

  <p>另外，如果其他进程都依赖一个进程，这个进程级别可能会提高 — 某个线程的级别不会比依赖它的线程的级别低。例如，如果线程 A 中的内容提供器给线程 B 中的客户端提供服务，或者线程 A 中的服务组件被绑定到线程 B 中，那么线程 A 总是被认为至少和线程 B 一样重要。</p>

  <p>因为一个运行服务的线程优先级高于后台活动的线程，一个包含长运行操作的活动可能会启动一个<a
href="../../guide/components/services.html">服务</a>来运行这个操作，而不是简单的创建一个工作线程 — 特别是这个长操作运行时间可能比活动可见周期更长。例如，一个上传图片到网站的活动应该启动一个服务来执行上传操作，这样即便用户离开这个活动图片仍然可以持续在后台上传。使用服务来确保操作至少会有“服务进程”优先级，而不会受活动状态影响。这也是广播接收器为什么应该使用服务而不是将花时间的操作在一个线程中运行的原因。</p>




<h2 id="Threads">线程</h2>

<p>当一个应用程序启动的时候，系统将会创建一个线程用于应用程序执行，这个线程称作"主线程"。这个进程是否重要，因为它掌管着呈现在用户面前的界面小部件的事件分发，包括绘画事件。这也是安卓用户界面工具包中的组件（<code><a href="../../reference/android/widget/package-summary.html">android.widget</a></code> 和 <code><a href="../../reference/android/view/package-summary.html">android.view</a></code> 包中的组件）在你的应用程序中发生交互的地方。因此，主线程有时候被叫成 UI 线程。</p>

<p>系统<em>不会</em>为某个组件的每个实例而单独创建一个线程。运行在同一个进程中的所有的组件都在 UI 线程中实例化，同时系统对每个组件的调用都是在这个线程中分发。因此,系统回调的响应方法（比如 <code><a href="../../reference/android/view/View.html#onKeyDown(int, android.view.KeyEvent)">onKeyDown()</a></code> 方法用于报告用户操作或用作一个生命周期的回调方法）总是运行在 UI 线程中以便进行处理。</p>

<p>例如，当用户点击屏幕上的一个按钮时，你的应用程序的 UI 线程分发触碰事件给对应的小部件，从而将按钮转变为按下状态同时发送一个无效化的请求到事件队列中。UI 线程让请求出列同时通知对应的小部件进行重新绘制。</p>

<p>当你的应用程序在密集地响应用户交互时，这种单线程模式可能表现欠佳除非你的应用程序有正确的实现。具体来说，如果所有的事都发生在 UI 线程中，进行耗时的操作比如网络连接或者数据库查询操作都将阻塞整个 UI 线程。当线程被阻塞的时候，没有事件可以被分发，包括绘画事件。从用户的角度，应用看起来被挂起了。更糟糕的是，如果 UI 线程被阻塞超过一定的时间（目前大概5秒）用户将会看见臭名昭著的"<a
href="http://developer.android.com/guide/practices/responsiveness.html">应用没有响应</a>“（ANR）对话框。如果用户不高兴的话,他们接下来也许会决定退出你的应用程序然后卸载掉它.</p>

<p>此外,安卓的界面工具包是<em>非</em>线程安全的。所以,你不允许从一个工作线程操作界面 — 你必须在 UI 线程中对你的用户界面进行所有的操作。因此，对于安卓的单线程模式这里只有两条简单的规则：</p>

<ol>
<li>不要阻塞 UI 线程
</li><li>不要在 UI 线程外修改安卓界面
</li></ol>

<h3 id="WorkerThreads">工作线程</h3>

<p>由于上述单线程模式对你的应用程序的界面有着至关重要的影响，因此你不可以阻塞 UI 线程。如果你有一个非实时的操作，你应当确保在单独的线程中对其进行操作（"后台"或者"工作"线程）。</p>

<p>例如，下面这段代码通过对一个点击事件进行监听，然后在一个单独的线程中下载图片并同时在 <code><a href="../../reference/android/widget/ImageView.html">ImageView</a></code> 中显示它。</p>

<pre>
public void onClick(View v) {
    new Thread(new Runnable() {
        public void run() {
            Bitmap b = loadImageFromNetwork("http://example.com/image.png");
            mImageView.setImageBitmap(b);
        }
    }).start();
}
</pre>

<p>一开始，它好像能正常工作，因为它创建了一个新的进程去处理网络操作。然而，它违反了单进程模型第二法则：<em>不要在 UI 线程外修改安卓界面</em> — 这个例子中使用工作线程对 <code><a href="../../reference/android/widget/ImageView.html">ImageView</a></code> 进行修改，而不是在 UI 线程中修改。这可能导致未定义或意想不到的行为，并且这些行为的追溯可能困难而且耗时。</p>

<p>要修复这个问题，安卓提供了几种途径在其他线程中访问 UI 线程。下面列出了一些方法，这也许可以帮助你：</p>

<ul>
<li><code><a href="../../reference/android/app/Activity.html#runOnUiThread(java.lang.Runnable)">Activity.runOnUiThread(Runnable)</a></code></li>
<li><code><a href="../../reference/android/view/View.html#post(java.lang.Runnable)">View.post(Runnable)</a></code></li>
<li><code><a href="../../reference/android/view/View.html#postDelayed(java.lang.Runnable, long)">View.postDelayed(Runnable,
long)</a></code></li>
</ul>

<p>例如，你可以通过使用 <code><a href="../../reference/android/view/View.html#post(java.lang.Runnable)">View.post(Runnable)</a></code> 方法来修复上面的代码：</p>

<pre>
public void onClick(View v) {
    new Thread(new Runnable() {
        public void run() {
            final Bitmap bitmap = loadImageFromNetwork("http://example.com/image.png");
            mImageView.post(new Runnable() {
                public void run() {
                    mImageView.setImageBitmap(bitmap);
                }
            });
        }
    }).start();
}
</pre>

<p>现在这个实现是线程安全的：当 <code><a href="../../reference/android/widget/ImageView.html">ImageView</a></code> 在 UI 线程中进行操作的时候，网络操作在一个单独的线程中完成。</p>

<p>但是，随着操作复杂性的增加，这样的代码可能维护起来既困难又复杂。为了在工作线程中处理更加复杂的交互，你可以考虑在你的工作线程中使用一个 <code><a href="../../reference/android/os/Handler.html">Handler</a></code> 去处理来自 UI 线程的信息递送。也许最好的解决方案是使用 <code><a href="../../reference/android/os/AsyncTask.html">AsyncTask</a></code> 类的扩展类，它会简化界面交互任务在工作进程中的执行。</p>


<h4 id="AsyncTask">使用异步任务</h4>

<p><code><a href="../../reference/android/os/AsyncTask.html">异步任务</a></code>允许你在你的用户界面上进行异步操作。它在工作线程中进行阻塞操作然后将结果发布到 UI 线程上，这不需要你去处理线程或程序本身。</p>

<p>要使用它，你必须继承 <code><a href="../../reference/android/os/AsyncTask.html">AsyncTask</a></code> 类，然后实现 <code><a href="../../reference/android/os/AsyncTask.html#doInBackground(Params...)">doInBackground()</a></code> 回调方法，该接口运行在一个后台线程池中。为了更新你的界面,你应当实现 <code><a href="../../reference/android/os/AsyncTask.html#onPostExecute(Result)">onPostExecute()</a></code> 方法该方法负责递送来自 <code><a href="../../reference/android/os/AsyncTask.html#doInBackground(Params...)">doInBackground()</a></code> 方法的结果然后在 UI 线程中运行，所以你可以安全的更新你的界面。接下来你就可以通过在 UI 线程调用 <code><a href="../../reference/android/os/AsyncTask.html#execute(Params...)">execute()</a></code> 方法来执行任务。</p>

<p>例如，你可以通过使用 <code><a href="../../reference/android/os/AsyncTask.html">AsyncTask</a></code> 实现之前的例子：</p>

<pre>
public void onClick(View v) {
    new DownloadImageTask().execute("http://example.com/image.png");
}

private class DownloadImageTask extends AsyncTask&lt;String, Void, Bitmap&gt; {
    /** The system calls this to perform work in a worker thread and
      * delivers it the parameters given to AsyncTask.execute() */
    protected Bitmap doInBackground(String... urls) {
        return loadImageFromNetwork(urls[0]);
    }
    
    /** The system calls this to perform work in the UI thread and delivers
      * the result from doInBackground() */
    protected void onPostExecute(Bitmap result) {
        mImageView.setImageBitmap(result);
    }
}
</pre>

<p>现在用户界面在安全的同时代码也更加简洁了，因为它把应当在工作线程中运行的部分和应当在 UI 线程运行的部分分开来了。</p>

<p>你应当阅读 <code><a href="../../reference/android/os/AsyncTask.html">AsyncTask</a></code> 的参考文献以获得一个关于如何去使用这个类的全面认识,但是这里有一个关于它如何工作的简要概述：</p>

<ul>
<li>你可以通过使用泛型来制定参数的类型，进度条的值和最后任务的返回值。</li>
<li> <code><a href="../../reference/android/os/AsyncTask.html#doInBackground(Params...)">doInBackground()</a></code> 方法将会在一个工作线程中自动运行</li>
<li><code><a href="../../reference/android/os/AsyncTask.html#onPreExecute()">onPreExecute()</a></code>方法、<code><a href="../../reference/android/os/AsyncTask.html#onPostExecute(Result)">onPostExecute()</a></code> 方法和 <code><a href="../../reference/android/os/AsyncTask.html#onProgressUpdate(Progress...)">onProgressUpdate()</a></code> 方法都是在 UI 线程中被调用的</li>
<li><code><a href="../../reference/android/os/AsyncTask.html#doInBackground(Params...)">doInBackground()</a></code> 方法的返回值将发送给 <code><a href="../../reference/android/os/AsyncTask.html#onPostExecute(Result)">onPostExecute()</a></code> 方法</li>
<li>无论什么时候,你都可以在 <code><a href="../../reference/android/os/AsyncTask.html#doInBackground(Params...)">doInBackground()</a></code> 方法中调用 <code><a href="../../reference/android/os/AsyncTask.html#publishProgress(Progress...)">publishProgress()</a></code> 去执行 UI 线程中的 <code><a href="../../reference/android/os/AsyncTask.html#onProgressUpdate(Progress...)">onProgressUpdate()</a></code> 方法。</li>
<li>在任何时候、任意线程中，你都可以取消该任务。</li>
</ul>

<p class="caution"><strong>警告：</strong>当活动中的工作线程因为<a
href="../../guide/topics/resources/runtime-changes.html">运行时配置变化</a>（如用户改变了屏幕方向）而重启，你可能会碰到其它问题，这些问题也可能会破坏你的工作线程。要了解如何当活动重启时保持这些异步任务或是如何在活动销毁时正确地取消异步任务，请查看 <a
href="http://code.google.com/p/shelves/">Shelves</a> 示例应用的源代码。</p>


<h3 id="ThreadSafe">线程安全方法</h3>

<p> 在一些情形中，一些方法可能会被超过一个线程调用，因此这些方法必须是线程安全的。 </p>

<p>这对一些需要远程调用的方法特别重要 — 如<a
href="../../guide/components/bound-services.html">绑定服务</a>中的方法。当对一个实现了 <code><a href="../../reference/android/os/IBinder.html">IBinder</a></code> 接口的方法在 <code><a href="../../reference/android/os/IBinder.html">IBinder</a></code> 正在运行的进程中调用，方法会在调用者的线程中执行。但是当方法从其它进程中调用时，该方法会在 <code><a href="../../reference/android/os/IBinder.html">IBinder</a></code> 进程中由系统管理的线程池中执行（不是在进程的 UI 线程中执行）。例如，尽管 <code><a href="../../reference/android/app/Service.html#onBind(android.content.Intent)">onBind()</a></code> 方法会在服务组件进程的 UI 线程中调用，<code><a href="../../reference/android/app/Service.html#onBind(android.content.Intent)">onBind()</a></code> 方法返回的对象中的方法（如一个实现了 RPC 方法的子类）将会在一个线程池中被调用。应为服务可以有超过一个客户，多个线程池可以同时访问 <code><a href="../../reference/android/os/IBinder.html">IBinder</a></code> 方法。因此 <code><a href="../../reference/android/os/IBinder.html">IBinder</a></code> 方法必须是一个线程安全的实现。</p>

<p> 相似的，内容提供器可以收到来自其他线程的数据请求。尽管 <code><a href="../../reference/android/content/ContentResolver.html">ContentResolver</a></code> 和 <code><a href="../../reference/android/content/ContentProvider.html">ContentProvider</a></code> 类隐藏了它们如何管理进程间通信的细节， <code><a href="../../reference/android/content/ContentProvider.html">ContentProvider</a></code> 中响应这些来自其它线程请求的方法 — 方法 <code><a href="../../reference/android/content/ContentProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">query()</a></code> 、<code><a href="../../reference/android/content/ContentProvider.html#insert(android.net.Uri, android.content.ContentValues)">insert()</a></code>、<code><a href="../../reference/android/content/ContentProvider.html#delete(android.net.Uri, java.lang.String, java.lang.String[])">delete()</a></code> 、<code><a href="../../reference/android/content/ContentProvider.html#update(android.net.Uri, android.content.ContentValues, java.lang.String, java.lang.String[])">update()</a></code> 和 <code><a href="../../reference/android/content/ContentProvider.html#getType(android.net.Uri)">getType()</a></code> — 都从一个内容提供器进程的线程池中被调用，而不是在进程的 UI 线程中调用。因为这些方法可能同时被多个线程调用，因此它们也必须是线程安全的。 </p>


<h2 id="IPC">进程间通信</h2>

<p>安卓提供一种用远程方法调用（RPC）来进行进程间通信（IPC）的机制，在这种机制下活动或者其它应用组件调用一个方法，但是该方法远程执行（在其它线程中），而执行的结果最终返回给调用者。这个机制将方法访问过程分解，将操作系统可以理解的数据从本地线程和地址空间传递到远程线程和地址空间，然后在远端组装数据并调用方法。返回值则在相反的方向上传播。安卓让所有的代码都能执行这些 IPC 事务，这样你可以集中注意在定义和实现 RPC 接口上。 </p>

<p>要执行 IPC，你的应用必须使用 <code><a href="../../reference/android/content/Context.html#bindService(android.content.Intent, android.content.ServiceConnection, int)">bindService()</a></code> 方法绑定到某个服务上。更多相关信息，查看<a
href="../../guide/components/services.html">服务</a>开发者文档。</p><!--
<h2>Beginner's Path</h2>

<p>For information about how to perform work in the background for an indefinite period of time
(without a user interface), continue with the <b><a
href="../../guide/components/services.html">Services</a></b> document.</p>
-->




    </div>
      
      <div class="content-footer layout-content-row" 
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-8" style="padding-top:4px">
          
            <div class="g-plusone" data-size="medium"></div>
          
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
      

  </div><!-- end jd-content --> 

<div id="footer" class="wrap" >
        

  <div id="copyright">
    
  
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="../../about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../support.html">Support</a>
  </p>
  </div>

</div><!-- end footer --> 
</div><!-- end doc-content -->

</div><!-- end body-content -->  






</body>
</html>



